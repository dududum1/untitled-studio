<!DOCTYPE html>
<html lang="en" data-theme="kodak">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#121212">
    <meta name="description"
        content="Untitled Studio is a privacy-first, offline-capable web image editor featuring 150+ professional film emulations, cinema-grade color grading, and real-time WebGL rendering.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="canonical" href="https://untitled-40w.pages.dev/">

    <title>Untitled Studio | Professional Film Emulation & Photo Editor</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="apple-touch-icon" href="assets/icons/favicon.svg">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&display=swap" rel="stylesheet">

    <style>
        :root {
            --terminal-bg: #121212;
            /* Deep Charcoal */
            --terminal-green: #00FF41;
            /* Matrix Green */
            --terminal-dim: #666666;
            /* Dimmed Prompt Color */
        }

        /* Navigation Container (Optional - positions the logo) */
        .nav-container {
            padding: 1rem 2rem;
            background-color: var(--terminal-bg);
            display: flex;
            align-items: center;
        }

        /* The Logo Itself */
        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 1.5rem;
            /* Adjust size as needed */
            text-decoration: none;
            color: var(--logo-color);
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.05em;
            /* Tighter tracking for code look */
            display: inline-flex;
            align-items: center;
            user-select: none;
            /* Prevents selecting text like a doc */
        }

        /* The ">" Prompt */
        .prompt {
            color: var(--terminal-dim);
            margin-right: 0.5rem;
        }

        /* The Blinking Cursor */
        .cursor {
            display: inline-block;
            width: 10px;
            height: 1.2rem;
            background-color: var(--accent);
            margin-left: 2px;
            animation: blink 1s step-end infinite;
        }

        /* Hard Blink Animation */
        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        /* Mobile adjustment */
        @media (max-width: 600px) {
            .logo {
                font-size: 1.2rem;
            }
        }

        /* Film Roll UI */
        .roll-divider {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .film-progress-strip {
            background-image: radial-gradient(circle, #333 20%, transparent 20%),
                radial-gradient(circle, #333 20%, transparent 20%);
            background-position: 0 0, 0 100%;
            background-size: 20px 20px;
            background-repeat: repeat-x;
        }

        @keyframes develop-ping {
            0% {
                box-shadow: 0 0 0 0 rgba(60, 162, 200, 0.4);
            }

            70% {
                box-shadow: 0 0 0 10px rgba(60, 162, 200, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(60, 162, 200, 0);
            }
        }

        .developing-glow {
            animation: develop-ping 2s infinite;
        }

        /* Terminal Viewer Styles */
        #terminal-viewer-overlay {
            background: linear-gradient(to bottom, rgba(18, 20, 18, 0.95), rgba(10, 15, 12, 0.98));
            backdrop-filter: blur(20px);
            pointer-events: auto;
        }

        #terminal-viewer-overlay::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 2;
            background-size: 100% 4px, 6px 100%;
            pointer-events: none;
        }

        .typing-active::after {
            content: 'â–ˆ';
            animation: terminalCursor 1s infinite;
        }

        @keyframes terminalCursor {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }
    </style>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'midnight': 'var(--midnight)',
                        'glass': 'var(--glass)',
                        'glass-border': 'var(--glass-border)',
                        'hot-pink': 'var(--hot-pink)',
                        'hot-pink-glow': 'var(--hot-pink-glow)',
                        'moonstone': 'var(--moonstone)',
                        'moonstone-glow': 'var(--moonstone-glow)',
                    },
                    fontFamily: {
                        'sans': ['Outfit', 'system-ui', 'sans-serif'],
                    },
                    backdropBlur: {
                        'glass': '12px',
                    }
                }
            }
        }
    </script>

    <!-- Custom Scripts -->
    <script src="js/lut-parser.js"></script>
    <link rel="stylesheet" href="css/styles.css?v=20">
</head>

<body class="bg-midnight text-white font-sans overflow-hidden select-none">
    <!-- Living Background (Deep Fog) -->
    <div id="deep-fog"></div>

    <!-- Manifesto Mode Grain -->
    <div id="manifesto-grain"
        class="fixed inset-0 pointer-events-none opacity-0 z-[100] transition-opacity duration-1000"></div>

    <!-- ========== BATCH BAR (Top) ========== -->
    <header id="batch-bar"
        class="fixed top-0 left-0 right-0 z-50 h-20 bg-glass backdrop-blur-glass border-b border-glass-border">
        <div class="flex items-center h-full px-4 gap-3">
            <!-- Logo -->
            <!-- Logo -->
            <nav class="nav-container" style="background: transparent; padding-left: 0;">
                <button id="install-btn"
                    class="hidden px-3 py-1 bg-hot-pink text-white rounded-sm text-[10px] tracking-wider font-bold hover:bg-pink-600 transition-colors flex items-center gap-2 mr-4">
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                    </svg>
                    INSTALL
                </button>
                <h1 class="flex items-center">
                    <a href="/" class="logo">
                        <span class="prompt">&gt;</span>untitled studio<span class="cursor"></span>
                    </a>
                </h1>
            </nav>

            <!-- Thumbnail Queue -->
            <div id="thumbnail-queue" class="flex-1 flex items-center gap-2 overflow-x-auto scrollbar-hide py-2">
                <button id="import-btn"
                    class="flex-shrink-0 w-14 h-14 rounded-xl border-2 border-dashed border-glass-border hover:border-hot-pink hover:bg-hot-pink/10 transition-all duration-300 flex items-center justify-center group"
                    title="Import Images">
                    <svg class="w-6 h-6 text-gray-500 group-hover:text-hot-pink transition-colors" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                </button>

                <!-- New Roll Button -->
                <button id="new-roll-btn"
                    class="flex-shrink-0 w-14 h-14 rounded-xl border-2 border-hot-pink/30 hover:border-hot-pink hover:bg-hot-pink/10 transition-all duration-300 flex items-center justify-center group"
                    title="Start New Roll (36 exp)">
                    <div class="flex flex-col items-center">
                        <span
                            class="text-[10px] font-bold text-hot-pink group-hover:scale-110 transition-transform">ROLL</span>
                        <span class="text-[8px] text-hot-pink/60">36</span>
                    </div>
                </button>
            </div>

            <!-- Toolbar Actions -->
            <div class="flex items-center gap-2 pl-4 border-l border-glass-border">
                <!-- Before/After Toggle -->
                <button id="before-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Hold to see original (B)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                </button>

                <!-- OLED Toggle -->
                <button id="oled-toggle-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="True Black Mode">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>

                <!-- CRT Toggle -->
                <button id="crt-toggle-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="CRT Visualization Mode">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                    </svg>
                </button>

                <!-- Hide UI Toggle -->
                <button id="toggle-ui-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Toggle UI (H)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>

                <!-- Sync All -->
                <button id="sync-all-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Sync All (S)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>

                <!-- Save Preset -->
                <button id="save-preset-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Save current adjustments as Preset">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                    </svg>
                </button>

                <!-- How to Edit -->
                <a href="how-to.html"
                    class="p-2 rounded-lg text-gray-400 hover:text-moonstone hover:bg-glass transition-all"
                    title="How to Edit / Guide">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </a>

                <!-- Export Settings -->
                <!-- Export Settings (Removed - Duplicate) -->
                <!-- <button id="export-settings-btn" ... > -->

                <!-- Sync/Export moved to bottom bar -->
            </div>

            <!-- Toggle Scopes -->
            <button id="toggle-scopes-btn"
                class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                title="Toggle Scopes (M)">
                <span class="font-mono font-bold text-xs">[M]</span>
            </button>
        </div>

        <!-- Split View Toggle (Centered in Header) -->
        <div
            class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center gap-2 bg-glass/80 backdrop-blur-md px-4 py-2 rounded-full border border-glass-border z-[60]">
            <label class="text-xs font-bold text-white/80">SPLIT</label>
            <label class="relative inline-flex items-center cursor-pointer">
                <input type="checkbox" id="split-view-toggle" class="sr-only peer">
                <div
                    class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-hot-pink rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-hot-pink">
                </div>
            </label>
        </div>
        </div>
    </header>

    <!-- ========== MAIN CANVAS AREA ========== -->
    <main
        class="fixed inset-0 pt-20 pb-48 md:pb-96 lg:pb-0 lg:right-[40vw] flex items-center justify-center bg-midnight transition-colors duration-700"
        id="main-stage">
        <div id="canvas-container" class="relative w-full h-full flex items-center justify-center overflow-hidden">
            <canvas id="gl-canvas"
                class="max-w-full max-h-full object-contain shadow-2xl transition-transform duration-200"></canvas>

            <!-- Vibe Overlays (Preview) -->
            <div id="vibe-overlay-container" class="absolute inset-0 pointer-events-none overflow-hidden hidden">
                <div id="date-stamp-preview"
                    class="absolute bottom-8 right-8 text-[#ff9900] font-mono text-xl tracking-widest opacity-80"
                    style="font-family: 'Share Tech Mono', monospace; text-shadow: 0 0 5px #ff4400;">
                    '98 01 28
                </div>
                <div id="watermark-preview"
                    class="absolute bottom-4 right-8 text-white/50 font-sans text-xs tracking-wider uppercase hidden">
                    Untitled Studio
                </div>
            </div>

            <!-- LQIP Export Overlay (hidden by default) -->
            <div id="lqip-overlay" class="hidden">
                <img id="lqip-image" alt="">
                <div class="lqip-progress-ring progress-ring">
                    <svg class="w-24 h-24 transform -rotate-90">
                        <circle class="progress-ring-bg" cx="48" cy="48" r="40" stroke-width="6" fill="none" />
                        <circle id="lqip-progress-fill" class="progress-ring-fill" cx="48" cy="48" r="40"
                            stroke-width="6" fill="none" stroke-dasharray="251.33" stroke-dashoffset="251.33" />
                    </svg>
                    <span id="lqip-progress-text" class="progress-text text-sm">0%</span>
                </div>
            </div>

            <!-- Histogram Overlay -->
            <!-- Scopes HUD (Floating) -->
            <div id="scopes-hud"
                class="absolute top-20 right-4 flex flex-col gap-2 z-50 pointer-events-none transition-opacity duration-300 hidden">
                <!-- Histogram -->
                <div id="histogram-container"
                    class="w-48 rounded-lg overflow-hidden bg-midnight/50 backdrop-blur-sm border border-glass-border pointer-events-auto">
                    <canvas id="histogram-canvas" width="192" height="112"></canvas>
                    <div class="flex items-center justify-between px-2 py-1.5 border-t border-glass-border">
                        <button id="auto-enhance-btn"
                            class="flex items-center gap-1 px-2 py-1 rounded bg-hot-pink/20 hover:bg-hot-pink/40 text-hot-pink text-[10px] font-bold transition-all"
                            title="Auto-Enhance (Magic Wand)">
                            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                                <path
                                    d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
                            </svg>
                            Auto
                        </button>
                        <label class="flex items-center gap-1 text-[10px] text-gray-400 cursor-pointer">
                            <input type="checkbox" id="clipping-toggle" class="accent-hot-pink w-3 h-3">
                            Clip
                        </label>
                    </div>
                </div>

                <!-- Vectorscope -->
                <div id="vectorscope-container"
                    class="w-48 h-48 rounded-lg overflow-hidden bg-midnight/50 backdrop-blur-sm border border-glass-border pointer-events-auto flex items-center justify-center relative">
                    <canvas id="vectorscope-canvas" width="192" height="192"></canvas>
                    <!-- Grid Overlay for Vectorscope -->
                    <svg class="absolute inset-0 w-full h-full pointer-events-none opacity-30" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="45" fill="none" stroke="white" stroke-width="0.5" />
                        <line x1="50" y1="5" x2="50" y2="95" stroke="white" stroke-width="0.5" />
                        <line x1="5" y1="50" x2="95" y2="50" stroke="white" stroke-width="0.5" />
                    </svg>
                </div>
            </div>

        </div>
        </div>



        <!-- Split View Slider Overlay (Hidden by default) -->
        <div id="split-slider-container" class="absolute inset-0 pointer-events-none hidden z-40">
            <input type="range" id="split-slider" min="0" max="1" step="0.001" value="0.5"
                class="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize pointer-events-auto z-50">
            <!-- Visual Divider Line -->
            <div id="split-line"
                class="absolute top-0 bottom-0 w-0.5 bg-white shadow-[0_0_10px_rgba(255,255,255,0.8)] left-1/2 pointer-events-none transition-all duration-75">
                <div
                    class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-lg flex items-center justify-center text-gray-800">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Before/After Label -->
        <div id="before-label"
            class="absolute top-4 left-4 px-3 py-1 rounded-lg bg-hot-pink text-white text-sm font-semibold hidden">
            ORIGINAL
        </div>

        <!-- Empty State -->
        <!-- Smart Placeholder -->
        <div id="placeholder-container"
            class="absolute inset-0 flex flex-col items-center justify-center p-8 transition-opacity duration-500 perspective-1000">
            <button id="import-hero-btn"
                class="relative group w-72 h-72 rounded-[32px] transition-all duration-300 transform-style-3d cursor-pointer focus:outline-none"
                title="Import Image" aria-label="Untitled Studio Interface Preview">

                <!-- 1. The Glass Core (Background) -->
                <div
                    class="absolute inset-0 rounded-[32px] bg-glass-solid/40 backdrop-blur-xl border border-white/10 shadow-2xl overflow-hidden transition-all duration-300 group-hover:border-white/20 group-hover:bg-glass-solid/50">
                    <!-- CRT Scanlines -->
                    <div class="absolute inset-0 bg-scanlines opacity-30 pointer-events-none mix-blend-overlay">
                    </div>
                    <!-- CRT Noise -->
                    <div
                        class="absolute inset-0 bg-noise opacity-10 pointer-events-none mix-blend-overlay animate-noise">
                    </div>
                    <!-- Chromatic Aberration Glow -->
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-hot-pink/20 to-moonstone/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500 blur-xl">
                    </div>
                </div>

                <!-- 2. Content Layer (Floating) -->
                <div class="absolute inset-0 flex flex-col items-center justify-center z-10 transform translate-z-20">
                    <!-- Plus Icon -->
                    <div class="relative w-20 h-20 flex items-center justify-center mb-6">
                        <div
                            class="absolute inset-0 bg-white/10 rounded-full blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 animate-pulse-slow">
                        </div>
                        <svg class="w-12 h-12 text-white/80 drop-shadow-[0_0_15px_rgba(255,255,255,0.3)] transition-all duration-300 group-hover:text-white group-hover:scale-110"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                    </div>

                    <!-- Typography -->
                    <span class="text-xs font-bold text-white/90 tracking-[0.2em] uppercase mb-2 drop-shadow-md">Open
                        Studio</span>
                    <div class="flex items-center gap-2">
                        <div class="w-1.5 h-1.5 rounded-full bg-neon-green animate-pulse"></div>
                        <span class="text-[10px] text-white/50 tracking-wider font-mono">READY</span>
                    </div>
                </div>
            </button>
        </div>

        </div>

        <input type="file" id="file-input" accept="image/*,.json" multiple hidden>
    </main>

    <!-- ========== HISTORY SIDEBAR ========== -->
    <aside id="history-sidebar"
        class="fixed top-20 right-0 w-64 h-[calc(100vh-20rem)] bg-glass backdrop-blur-glass border-l border-glass-border transform translate-x-full transition-transform z-40">
        <div class="flex items-center justify-between p-4 border-b border-glass-border">
            <h3 class="font-semibold text-sm">History</h3>
            <button id="close-history-btn" class="p-1 rounded hover:bg-glass">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div id="history-list" class="overflow-y-auto h-full p-2">
            <!-- History items will be inserted here -->
        </div>
    </aside>

    <!-- ========== STUDIO DOCK (Bottom / Sidebar on Desktop) ========== -->
    <aside id="studio-dock"
        class="fixed bottom-[48px] left-0 right-0 lg:top-20 lg:left-auto lg:w-[40vw] lg:h-auto lg:bottom-[48px] z-50 bg-glass backdrop-blur-glass border-t lg:border-t-0 lg:border-l border-glass-border flex flex-col transition-all duration-500 pb-[env(safe-area-inset-bottom)] lg:pb-0">

        <!-- Accordion Container -->
        <div id="accordion-container" class="flex-1 overflow-y-auto scrollbar-hide pb-safe">



            <!-- TONE Section -->
            <div class="accordion-item active" data-section="tone">
                <button class="accordion-header">
                    <span class="indicator">[ â€” ]</span> <span class="label" data-cipher="TONE">TONE</span>
                </button>
                <div class="accordion-content">
                    <div id="tone-panel" class="panel p-6">
                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Exposure</label>
                                    <span class="slider-value" data-for="exposure" data-scrub="exposure">0.00</span>
                                </div>
                                <input type="range" id="exposure" class="studio-slider" min="-2" max="2" step="0.01"
                                    value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Contrast</label>
                                    <span class="slider-value" data-for="contrast" data-scrub="contrast">0</span>
                                </div>
                                <input type="range" id="contrast" class="studio-slider" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Highlights</label>
                                    <span class="slider-value" data-for="highlights" data-scrub="highlights">0</span>
                                </div>
                                <input type="range" id="highlights" class="studio-slider" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Shadows</label>
                                    <span class="slider-value" data-for="shadows" data-scrub="shadows">0</span>
                                </div>
                                <input type="range" id="shadows" class="studio-slider" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Whites</label>
                                    <span class="slider-value" data-for="whites" data-scrub="whites">0</span>
                                </div>
                                <input type="range" id="whites" class="studio-slider" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Blacks</label>
                                    <span class="slider-value" data-for="blacks" data-scrub="blacks">0</span>
                                </div>
                                <input type="range" id="blacks" class="studio-slider" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CURVE Section -->
            <div class="accordion-item" data-section="curve">
                <button class="accordion-header">
                    <span class="indicator">[ + ]</span> <span class="label" data-cipher="CURVE">CURVE</span>
                </button>
                <div class="accordion-content">
                    <div id="curve-panel" class="panel p-6">
                        <div class="flex gap-4">
                            <div class="flex-shrink-0">
                                <div class="flex gap-1 mb-2">
                                    <button class="curve-channel active" data-channel="rgb">RGB</button>
                                    <button class="curve-channel" data-channel="r">R</button>
                                    <button class="curve-channel" data-channel="g">G</button>
                                    <button class="curve-channel" data-channel="b">B</button>
                                    <button id="reset-curve-btn"
                                        class="ml-2 px-2 py-1 text-xs text-gray-400 hover:text-white">Reset</button>
                                </div>
                                <svg id="tone-curve-svg"
                                    class="w-48 h-48 bg-midnight/50 rounded-lg border border-glass-border cursor-crosshair"></svg>
                            </div>
                            <div class="flex-1 text-sm text-gray-400">
                                <p class="mb-2">Drag points to adjust tones:</p>
                                <ul class="list-disc list-inside text-xs space-y-1">
                                    <li>Lift shadows for fade</li>
                                    <li>S-curve for contrast</li>
                                    <li>Inverted for negative</li>
                                </ul>
                            </div>
                        </div>
                        <!-- Controls -->
                        <div class="flex justify-center gap-4 mt-2">
                            <button id="curve-add-point-btn" class="px-4 py-2 bg-glass rounded hover:bg-glass-border">
                                <span class="text-hot-pink font-bold text-lg">+</span> <span class="text-xs">Add
                                    Point</span>
                            </button>
                            <button id="curve-delete-point-btn"
                                class="px-4 py-2 bg-glass rounded hover:bg-glass-border disabled:opacity-50" disabled>
                                <span class="text-red-500 font-bold text-lg">ðŸ—‘</span> <span
                                    class="text-xs">Delete</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- COLOR Section -->
            <div class="accordion-item" data-section="color">
                <button class="accordion-header">
                    <span class="indicator">[ + ]</span> <span class="label" data-cipher="COLOR">COLOR</span>
                </button>
                <div class="accordion-content">
                    <div id="color-panel" class="panel p-6">
                        <!-- Custom LUT -->
                        <div class="mb-6 pb-4 border-b border-glass-border">
                            <div class="flex items-center justify-between mb-3">
                                <label class="text-sm font-semibold text-gray-300">3D LUT (.cube)</label>
                                <div class="flex gap-2">
                                    <button id="remove-lut-btn"
                                        class="text-xs text-red-400 hover:text-red-300 hidden">Remove</button>
                                    <button id="import-lut-btn"
                                        class="text-xs bg-glass hover:bg-glass-border px-2 py-1 rounded text-moonstone">+
                                        Import</button>
                                    <input type="file" id="lut-input" accept=".cube" hidden>
                                </div>
                            </div>
                            <div id="lut-controls" class="hidden">
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Opacity</label>
                                        <span class="slider-value" data-for="lutOpacity"
                                            data-scrub="lutOpacity">1.0</span>
                                    </div>
                                    <input type="range" id="lutOpacity" class="studio-slider" min="0" max="100" step="1"
                                        value="100">
                                </div>
                                <div id="lut-name" class="text-[10px] text-gray-500 mt-1 truncate"></div>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Temperature</label>
                                    <span class="slider-value" data-for="temperature" data-scrub="temperature">0</span>
                                </div>
                                <input type="range" id="temperature" class="studio-slider temp" min="-100" max="100"
                                    step="1" value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Tint</label>
                                    <span class="slider-value" data-for="tint" data-scrub="tint">0</span>
                                </div>
                                <input type="range" id="tint" class="studio-slider tint" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Vibrance</label>
                                    <span class="slider-value" data-for="vibrance" data-scrub="vibrance">0</span>
                                </div>
                                <input type="range" id="vibrance" class="studio-slider" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Saturation</label>
                                    <span class="slider-value" data-for="saturation" data-scrub="saturation">0</span>
                                </div>
                                <input type="range" id="saturation" class="studio-slider" min="-100" max="100" step="1"
                                    value="0">
                            </div>
                        </div>

                        <!-- Color Grading Wheels -->
                        <div class="mt-6">
                            <h3 class="text-sm font-semibold text-gray-400 mb-3">Color Grading</h3>
                            <div class="grid grid-cols-3 gap-2">
                                <div class="text-center">
                                    <label class="text-[10px] text-gray-500 mb-1 block">Shadows</label>
                                    <canvas id="wheel-shadows" width="100" height="100"
                                        class="w-full aspect-square cursor-crosshair rounded-full border border-glass-border"></canvas>
                                </div>
                                <div class="text-center">
                                    <label class="text-[10px] text-gray-500 mb-1 block">Midtones</label>
                                    <canvas id="wheel-midtones" width="100" height="100"
                                        class="w-full aspect-square cursor-crosshair rounded-full border border-glass-border"></canvas>
                                </div>
                                <div class="text-center">
                                    <label class="text-[10px] text-gray-500 mb-1 block">Highlights</label>
                                    <canvas id="wheel-highlights" width="100" height="100"
                                        class="w-full aspect-square cursor-crosshair rounded-full border border-glass-border"></canvas>
                                </div>
                            </div>
                            <div class="grid grid-cols-3 gap-2 mt-2">
                                <input type="range" id="splitShadowSat" class="studio-slider small" min="0" max="100"
                                    value="0" title="Shadow Saturation">
                                <input type="range" id="splitMidtoneSat" class="studio-slider small" min="0" max="100"
                                    value="0" title="Midtone Saturation">
                                <input type="range" id="splitHighlightSat" class="studio-slider small" min="0" max="100"
                                    value="0" title="Highlight Saturation">
                            </div>
                            <div class="mt-2 text-center text-[10px] text-gray-600">Balance</div>
                            <input type="range" id="splitBalance" class="studio-slider" min="-100" max="100" step="1"
                                val="0">
                        </div>

                        <!-- Vectorscope -->
                        <div class="mt-6">
                            <h3 class="text-sm font-semibold text-gray-400 mb-3 flex items-center justify-between">
                                <span>Vectorscope</span>
                                <button id="toggle-vectorscope"
                                    class="text-[10px] bg-white/5 px-2 py-1 rounded hover:bg-white/10 transition">Show/Hide</button>
                            </h3>
                            <div id="vectorscope-container"
                                class="hidden relative aspect-square w-full bg-black rounded-lg border border-glass-border overflow-hidden">
                                <canvas id="vectorscope-canvas" width="256" height="256"
                                    class="w-full h-full object-contain"></canvas>
                            </div>
                        </div>

                        <!-- HSL Mixer -->
                        <div class="mt-6">
                            <h3 class="text-sm font-semibold text-gray-400 mb-3">HSL Mixer</h3>
                            <div class="flex gap-2 mb-4">
                                <button class="hsl-channel active" data-channel="hue">Hue</button>
                                <button class="hsl-channel" data-channel="sat">Saturation</button>
                                <button class="hsl-channel" data-channel="lum">Luminance</button>
                            </div>
                            <div id="hsl-sliders" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-red-500"></div><input type="range" class="hsl-slider"
                                        data-color="red" min="-100" max="100" value="0">
                                </div>
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-orange-500"></div><input type="range"
                                        class="hsl-slider" data-color="orange" min="-100" max="100" value="0">
                                </div>
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-yellow-500"></div><input type="range"
                                        class="hsl-slider" data-color="yellow" min="-100" max="100" value="0">
                                </div>
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-green-500"></div><input type="range" class="hsl-slider"
                                        data-color="green" min="-100" max="100" value="0">
                                </div>
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-cyan-500"></div><input type="range" class="hsl-slider"
                                        data-color="aqua" min="-100" max="100" value="0">
                                </div>
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-blue-500"></div><input type="range" class="hsl-slider"
                                        data-color="blue" min="-100" max="100" value="0">
                                </div>
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-purple-500"></div><input type="range"
                                        class="hsl-slider" data-color="purple" min="-100" max="100" value="0">
                                </div>
                                <div class="hsl-slider-group">
                                    <div class="hsl-color-dot bg-pink-500"></div><input type="range" class="hsl-slider"
                                        data-color="magenta" min="-100" max="100" value="0">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- EFFECTS Tab -->
            <!-- EFFECTS ACCORDION ITEM -->
            <div class="accordion-item" data-section="fx">
                <button class="accordion-header">
                    <span class="indicator">[ + ]</span> <span class="label" data-cipher="FX">FX</span>
                </button>
                <div class="accordion-content">
                    <div class="p-4 space-y-6">
                        <div id="effects-panel" class="panel">
                            <!-- OUTPUT TRANSFORM (PRINT STOCK) -->
                            <div class="mb-6 pb-4 border-b border-glass-border">
                                <div class="flex items-center justify-between mb-2">
                                    <label class="text-xs text-hot-pink font-bold tracking-wider uppercase">Output
                                        Transform</label>
                                    <span class="text-[10px] text-gray-500">Cinema Print Emulation</span>
                                </div>
                                <div class="flex bg-glass rounded-lg p-1 border border-glass-border">
                                    <button
                                        class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn active bg-hot-pink/20 text-hot-pink font-semibold shadow-[0_0_10px_rgba(237,39,136,0.2)]"
                                        data-stock="0">Standard</button>
                                    <button
                                        class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn text-gray-400"
                                        data-stock="1">Kodak 2383</button>
                                    <button
                                        class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn text-gray-400"
                                        data-stock="2">Fuji 3513</button>
                                    <button
                                        class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn text-gray-400"
                                        data-stock="3">Cineon Log</button>
                                </div>
                            </div>

                            <!-- Sub-tab Navigation (Pill Style) -->
                            <div
                                class="flex gap-2 mb-6 overflow-x-auto scrollbar-hide pb-1 border-b border-glass-border">
                                <button
                                    class="fx-subtab-btn active px-3 py-1.5 rounded-lg bg-white/10 text-white text-xs font-semibold whitespace-nowrap hover:bg-white/20 transition-all"
                                    data-subtab="optics">Optics</button>
                                <button
                                    class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                                    data-subtab="grain">Grain</button>
                                <button
                                    class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                                    data-subtab="creative">Creative</button>
                                <button
                                    class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                                    data-subtab="vibe">Atmosphere</button>
                                <button
                                    class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                                    data-subtab="digital">Digital</button>
                                <button
                                    class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                                    data-subtab="texture">Texture</button>
                                <button
                                    class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                                    data-subtab="frame">Frame</button>
                            </div>

                            <!-- FRAME SUB-PANEL (Advanced Borders) -->
                            <!-- Duplicate Frame Removed -->

                            <!-- 1. OPTICS SUB-PANEL -->
                            <div id="fx-optics"
                                class="fx-subpanel active grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Dehaze</label>
                                        <span class="slider-value" data-for="dehaze" data-scrub="dehaze">0</span>
                                    </div>
                                    <input type="range" id="dehaze" class="studio-slider" min="-100" max="100" step="1"
                                        value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Clarity</label>
                                        <span class="slider-value" data-for="clarity" data-scrub="clarity">0</span>
                                    </div>
                                    <input type="range" id="clarity" class="studio-slider" min="-100" max="100" step="1"
                                        value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Sharpness</label>
                                        <span class="slider-value" data-for="sharpness" data-scrub="sharpness">0</span>
                                    </div>
                                    <input type="range" id="sharpness" class="studio-slider" min="0" max="100" step="1"
                                        value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Vignette</label>
                                        <span class="slider-value" data-for="vignette" data-scrub="vignette">0</span>
                                    </div>
                                    <input type="range" id="vignette" class="studio-slider" min="0" max="100" step="1"
                                        value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Fade</label>
                                        <span class="slider-value" data-for="fade" data-scrub="fade">0</span>
                                    </div>
                                    <input type="range" id="fade" class="studio-slider" min="0" max="100" step="1"
                                        value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Lens Fringing</label>
                                        <span class="slider-value" data-for="chromaticAberration"
                                            data-scrub="chromaticAberration">0</span>
                                    </div>
                                    <input type="range" id="chromaticAberration" class="studio-slider" min="0" max="100"
                                        step="1" value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Barrel Distortion</label>
                                        <span class="slider-value" data-for="barrelDistortion"
                                            data-scrub="barrelDistortion">0</span>
                                    </div>
                                    <input type="range" id="barrelDistortion" class="studio-slider" min="-100" max="100"
                                        step="1" value="0">
                                </div>
                            </div>

                            <!-- 2. GRAIN SUB-PANEL -->
                            <div id="fx-grain"
                                class="fx-subpanel hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Grain Mode</label>
                                    </div>
                                    <select id="grainType"
                                        class="w-full bg-glass border border-glass-border rounded text-xs text-gray-300 p-2">
                                        <option value="0">Digital (Gaussian)</option>
                                        <option value="1">Negative (Emulsion)</option>
                                        <option value="2">Slide (Micro-Grain)</option>
                                        <option value="3">Analog (35mm Scan)</option>
                                    </select>
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Global Grain</label>
                                        <span class="slider-value" data-for="grainGlobal"
                                            data-scrub="grainGlobal">1.0</span>
                                    </div>
                                    <input type="range" id="grainGlobal" class="studio-slider" min="0" max="2"
                                        step="0.1" value="1">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Shadow Grain</label>
                                        <span class="slider-value" data-for="grainShadow"
                                            data-scrub="grainShadow">0</span>
                                    </div>
                                    <input type="range" id="grainShadow" class="studio-slider" min="0" max="100"
                                        step="1" value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Highlight Grain</label>
                                        <span class="slider-value" data-for="grainHighlight"
                                            data-scrub="grainHighlight">0</span>
                                    </div>
                                    <input type="range" id="grainHighlight" class="studio-slider" min="0" max="100"
                                        step="1" value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Grain Size</label>
                                        <span class="slider-value" data-for="grainSize"
                                            data-scrub="grainSize">1.0</span>
                                    </div>
                                    <input type="range" id="grainSize" class="studio-slider" min="0.5" max="3"
                                        step="0.1" value="1">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Noise Color</label>
                                        <span class="slider-value" data-for="noiseColorHue"
                                            data-scrub="noiseColorHue">0</span>
                                    </div>
                                    <input type="range" id="noiseColorHue" class="studio-slider" min="0" max="360"
                                        step="1" value="0">
                                </div>
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>AI Denoise</label>
                                        <span class="slider-value" data-for="denoise" data-scrub="denoise">0</span>
                                    </div>
                                    <input type="range" id="denoise" class="studio-slider" min="0" max="100" step="1"
                                        value="0">
                                </div>

                                <!-- Dithering Engine -->
                                <div class="mt-4 pt-4 border-t border-glass-border">
                                    <label class="text-xs text-gray-500 mb-2 block">Dithering (Lo-Fi)</label>
                                    <div class="slider-group mb-2">
                                        <div class="slider-header">
                                            <label>Algorithm</label>
                                        </div>
                                        <select id="ditherType"
                                            class="w-full bg-glass border border-glass-border rounded text-xs text-gray-300 p-2">
                                            <option value="0">Off</option>
                                            <option value="1">Floyd-Steinberg</option>
                                            <option value="2">Atkinson (Mac)</option>
                                            <option value="3">Bayer 4x4 (Retro)</option>
                                            <option value="4">Random Noise</option>
                                        </select>
                                    </div>
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Color Depth</label>
                                            <span class="slider-value" data-for="ditherDepth"
                                                data-scrub="ditherDepth">8</span>
                                        </div>
                                        <input type="range" id="ditherDepth" class="studio-slider" min="2" max="8"
                                            step="1" value="8">
                                    </div>
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Strength</label>
                                            <span class="slider-value" data-for="ditherStrength"
                                                data-scrub="ditherStrength">0</span>
                                        </div>
                                        <input type="range" id="ditherStrength" class="studio-slider" min="0" max="100"
                                            step="1" value="0">
                                    </div>

                                    <!-- LUT Export -->
                                    <div class="mt-4 pt-4 border-t border-glass-border">
                                        <button id="export-lut-btn"
                                            class="w-full px-4 py-2 rounded-lg bg-gradient-to-r from-moonstone/30 to-hot-pink/30 
                                       text-white text-sm font-semibold hover:from-moonstone/50 hover:to-hot-pink/50 
                                       border border-moonstone/30 transition-all flex items-center justify-center gap-2">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                            </svg>
                                            Export as .cube LUT
                                        </button>
                                        <p class="text-xs text-gray-500 mt-2 text-center">Save your color grade for
                                            video editors
                                        </p>
                                    </div>
                                </div>
                            </div> <!-- End fx-grain -->
                            <!-- Effects sub-panels continue below -->

                            <!-- 3. VIBE SUB-PANEL -->
                            <div id="fx-vibe" class="fx-subpanel hidden">

                                <div id="atmosphere-controls" class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Bloom Strength</label>
                                            <span class="slider-value" data-for="bloomStrength"
                                                data-scrub="bloomStrength">0</span>
                                        </div>
                                        <input type="range" id="bloomStrength" class="studio-slider" min="0" max="100"
                                            step="1" value="0">
                                    </div>
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Bloom Threshold</label>
                                            <span class="slider-value" data-for="bloomThreshold"
                                                data-scrub="bloomThreshold">70</span>
                                        </div>
                                        <input type="range" id="bloomThreshold" class="studio-slider" min="0" max="100"
                                            step="1" value="70">
                                    </div>
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Halation</label>
                                            <span class="slider-value" data-for="halation"
                                                data-scrub="halation">0</span>
                                        </div>
                                        <input type="range" id="halation" class="studio-slider" min="0" max="100"
                                            step="1" value="0">
                                    </div>
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Mist Diffusion</label>
                                            <span class="slider-value" data-for="diffusion"
                                                data-scrub="diffusion">0</span>
                                        </div>
                                        <input type="range" id="diffusion" class="studio-slider" min="0" max="100"
                                            step="1" value="0">
                                    </div>

                                    <!-- Glow Tint -->
                                    <div class="bg-glass border border-glass-border rounded-lg p-3 sm:col-span-2">
                                        <label
                                            class="text-xs text-gray-400 mb-2 block uppercase tracking-tighter font-bold">Glow
                                            Tint</label>
                                        <div class="flex gap-2">
                                            <input type="color" id="glowColor" value="#ff6699"
                                                class="w-10 h-10 rounded-lg cursor-pointer border-0 bg-transparent p-0">
                                            <div class="flex-1 grid grid-cols-5 gap-1">
                                                <button
                                                    class="h-10 rounded bg-white border border-gray-600 glow-color-preset hover:scale-105 transition-transform"
                                                    data-color="#ffffff" title="Neutral Bloom"></button>
                                                <button
                                                    class="h-10 rounded bg-[#ff6699] border border-gray-600 glow-color-preset hover:scale-105 transition-transform"
                                                    data-color="#ff6699" title="Classic Halation"></button>
                                                <button
                                                    class="h-10 rounded bg-[#ffa500] border border-gray-600 glow-color-preset hover:scale-105 transition-transform"
                                                    data-color="#ffa500" title="Warm Glow"></button>
                                                <button
                                                    class="h-10 rounded bg-[#00ffff] border border-gray-600 glow-color-preset hover:scale-105 transition-transform"
                                                    data-color="#00ffff" title="Cool Mist"></button>
                                                <button
                                                    class="h-10 rounded bg-[#7cfc00] border border-gray-600 glow-color-preset hover:scale-105 transition-transform"
                                                    data-color="#7cfc00" title="Nuclear"></button>
                                            </div>
                                        </div>

                                        <!-- SPECTRAL IMAGING (Phase VIII) -->
                                        <div class="mb-4 pt-4 border-t border-glass-border">
                                            <label
                                                class="text-xs text-gray-400 font-bold mb-2 block uppercase tracking-wider">Spectral
                                                Vision</label>
                                            <div class="flex bg-glass rounded-lg p-1 border border-glass-border mb-3">
                                                <button
                                                    class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all spectral-mode-btn active bg-hot-pink/20 text-hot-pink font-semibold"
                                                    data-mode="0">OFF</button>
                                                <button
                                                    class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all spectral-mode-btn text-gray-400"
                                                    data-mode="1">Ironbow</button>
                                                <button
                                                    class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all spectral-mode-btn text-gray-400"
                                                    data-mode="2">Rainbow</button>
                                                <button
                                                    class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all spectral-mode-btn text-gray-400"
                                                    data-mode="3">Aerochrome</button>
                                            </div>
                                            <div class="slider-group">
                                                <div class="slider-header">
                                                    <label>Intensity</label>
                                                    <span class="slider-value" data-for="thermalIntensity"
                                                        data-scrub="thermalIntensity">0</span>
                                                </div>
                                                <input type="range" id="thermalIntensity" class="studio-slider" min="0"
                                                    max="100" step="1" value="0">
                                            </div>
                                        </div>

                                        <div class="slider-group mb-4">
                                            <label class="text-xs text-gray-500 mb-2 block">Border Overlays</label>
                                            <select id="vibe-border-select"
                                                class="w-full bg-glass border border-glass-border rounded text-xs text-gray-300 p-2 focus:ring-hot-pink focus:border-hot-pink">
                                                <option value="">None</option>
                                                <option value="assets/border.svg">Torn Paper</option>
                                                <option value="assets/film.svg">Film Frame</option>
                                            </select>
                                        </div>

                                        <div class="space-y-3 pt-2">
                                            <button id="toggle-terminal-btn"
                                                class="w-full bg-moonstone/10 border border-moonstone/30 hover:bg-moonstone/20 text-moonstone py-3 rounded-lg text-xs font-bold flex items-center justify-center gap-2 transition-all active:scale-95 group">
                                                <span
                                                    class="opacity-70 group-hover:scale-110 transition-transform">ðŸ“Ÿ</span>
                                                <span>TERMINAL_ANALYSIS [RAW]</span>
                                            </button>
                                        </div>

                                        <!-- Procedural Light Leak (New) -->
                                        <div class="mb-4 border-t border-glass-border pt-4">
                                            <label
                                                class="text-xs text-hot-pink font-bold mb-2 block uppercase tracking-wider flex justify-between items-center">
                                                Light Leak (Beta)
                                                <div class="flex items-center gap-2">
                                                    <span class="text-[10px] text-gray-500 font-normal">Color</span>
                                                    <input type="color" id="lightLeakColor" value="#ff4500"
                                                        class="w-4 h-4 rounded-full border-0 p-0 overflow-hidden cursor-pointer"
                                                        title="Leak Color">
                                                </div>
                                            </label>

                                            <div class="slider-group">
                                                <div class="slider-header">
                                                    <label>Intensity</label>
                                                    <span class="slider-value" data-for="lightLeakIntensity"
                                                        data-scrub="lightLeakIntensity">0</span>
                                                </div>
                                                <input type="range" id="lightLeakIntensity" class="studio-slider"
                                                    min="0" max="100" step="1" value="0">
                                            </div>

                                            <div class="slider-group">
                                                <div class="slider-header">
                                                    <label>Entropy (Seed)</label>
                                                    <span class="slider-value" data-for="lightLeakEntropy"
                                                        data-scrub="lightLeakEntropy">0</span>
                                                </div>
                                                <input type="range" id="lightLeakEntropy" class="studio-slider" min="0"
                                                    max="100" step="1" value="0">
                                            </div>

                                            <div class="slider-group">
                                                <div class="slider-header">
                                                    <label>Scale</label>
                                                    <span class="slider-value" data-for="lightLeakScale"
                                                        data-scrub="lightLeakScale">50</span>
                                                </div>
                                                <input type="range" id="lightLeakScale" class="studio-slider" min="1"
                                                    max="100" step="1" value="50">
                                            </div>
                                        </div>



                                        <!-- Shuffle defects only -->
                                        <button id="randomize-seed-btn"
                                            class="w-full mt-3 py-1.5 rounded-lg bg-glass hover:bg-glass-border text-xs text-moonstone flex items-center justify-center gap-2 transition-all">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                            Shuffle All Defects
                                        </button>
                                    </div> <!-- End glow tint / col-span-2 -->
                                </div> <!-- End atmosphere-controls -->
                            </div> <!-- End fx-vibe -->

                            <!-- 4. DIGITAL SUB-PANEL -->
                            <div id="fx-digital" class="fx-subpanel hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Glitch</label>
                                        <span class="slider-value" data-for="glitchStrength"
                                            data-scrub="glitchStrength">0</span>
                                    </div>
                                    <input type="range" id="glitchStrength" class="studio-slider" min="0" max="100"
                                        step="1" value="0">
                                </div>

                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Pixelate</label>
                                        <span class="slider-value" data-for="pixelateSize"
                                            data-scrub="pixelateSize">0</span>
                                    </div>
                                    <input type="range" id="pixelateSize" class="studio-slider" min="0" max="20"
                                        step="1" value="0">
                                </div>

                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Dither</label>
                                        <span class="slider-value" data-for="ditherStrength"
                                            data-scrub="ditherStrength">0</span>
                                    </div>
                                    <input type="range" id="ditherStrength" class="studio-slider" min="0" max="100"
                                        step="1" value="0">
                                </div>

                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Scanlines</label>
                                        <span class="slider-value" data-for="scanlineIntensity"
                                            data-scrub="scanlineIntensity">0</span>
                                    </div>
                                    <input type="range" id="scanlineIntensity" class="studio-slider" min="0" max="100"
                                        step="1" value="0">
                                </div>

                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>ASCII</label>
                                        <span class="slider-value" data-for="asciiSize" data-scrub="asciiSize">0</span>
                                    </div>
                                    <input type="range" id="asciiSize" class="studio-slider" min="0" max="2" step="0.01"
                                        value="0">

                                    <div class="flex gap-2 mt-2">
                                        <button id="copy-ascii-btn"
                                            class="px-2 rounded bg-glass border border-glass-border hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                                            title="Copy ASCII to Clipboard">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3">
                                                </path>
                                            </svg>
                                        </button>
                                        <select id="asciiMode"
                                            class="flex-1 bg-glass border border-glass-border rounded text-[10px] text-gray-300 p-1 focus:ring-hot-pink outline-none">
                                            <option value="0">Full Color</option>
                                            <option value="1">Matrix Green</option>
                                            <option value="2">Amber Terminal</option>
                                            <option value="3">Black & White</option>
                                            <option value="4">Custom Tint</option>
                                        </select>
                                        <input type="color" id="asciiColor" value="#00ff66"
                                            class="w-8 h-6 bg-transparent cursor-pointer rounded hidden"
                                            title="Custom ASCII Color">
                                    </div>
                                </div>

                                <div class="slider-group">
                                    <div class="slider-header">
                                        <label>Posterize</label>
                                        <span class="slider-value" data-for="posterize" data-scrub="posterize">0</span>
                                    </div>
                                    <input type="range" id="posterize" class="studio-slider" min="0" max="100" step="1"
                                        value="0">
                                </div>
                            </div>

                            <!-- 5. TEXTURE SUB-PANEL -->
                            <div id="fx-texture" class="fx-subpanel hidden">
                                <div class="flex items-center justify-between mb-3 border-b border-glass-border pb-2">
                                    <label class="text-sm font-semibold text-gray-300">Texture Overlays</label>
                                    <div class="flex gap-2">
                                        <button id="remove-texture-btn"
                                            class="text-xs text-red-400 hover:text-red-300 hidden">Remove</button>
                                        <button id="import-texture-btn"
                                            class="text-xs bg-glass hover:bg-glass-border px-2 py-1 rounded text-moonstone">+
                                            Import</button>
                                    </div>
                                </div>

                                <!-- Built-in Textures -->
                                <div class="grid grid-cols-4 gap-2 mb-4">
                                    <button
                                        class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                        style="background-image: url('assets/textures/dust_scratches.png')"
                                        data-texture="dust" data-mode="2" title="Dust & Scratches"></button>
                                    <button
                                        class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                        style="background-image: url('assets/textures/leak_warm.png')"
                                        data-texture="leakWarm" data-mode="2" title="Warm Leak"></button>
                                    <button
                                        class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                        style="background-image: url('assets/textures/leak_cool.png')"
                                        data-texture="leakCool" data-mode="2" title="Cool Leak"></button>
                                    <button
                                        class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                        style="background-image: url('assets/textures/paper.png')" data-texture="paper"
                                        data-mode="1" title="Paper"></button>
                                </div>

                                <div class="flex gap-2 mb-4">
                                    <button id="import-texture-btn-alt"
                                        class="flex-1 bg-glass border border-glass-border rounded p-2 text-xs text-gray-300 hover:bg-white/5 flex items-center justify-center gap-2">
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                        </svg>
                                        Custom...
                                    </button>
                                    <input type="file" id="texture-input" accept="image/*" class="hidden">
                                </div>

                                <div id="texture-controls" class="space-y-4">
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Overlay Opacity</label>
                                            <span class="slider-value" data-for="overlayOpacity"
                                                data-scrub="overlayOpacity">0</span>
                                        </div>
                                        <input type="range" id="overlayOpacity" class="studio-slider" min="0" max="100"
                                            step="1" value="0">
                                    </div>

                                    <div class="slider-group">
                                        <label class="text-xs text-gray-500 mb-1 block">Blend Mode</label>
                                        <div class="flex bg-glass rounded-lg p-1" id="blend-mode-btns">
                                            <button
                                                class="flex-1 py-1 text-xs rounded hover:bg-white/10 transition-colors blend-mode-btn"
                                                data-mode="1">Multiply</button>
                                            <button
                                                class="flex-1 py-1 text-xs rounded hover:bg-white/10 transition-colors blend-mode-btn active bg-moonstone/20 text-moonstone"
                                                data-mode="2">Screen</button>
                                            <button
                                                class="flex-1 py-1 text-xs rounded hover:bg-white/10 transition-colors blend-mode-btn"
                                                data-mode="3">Overlay</button>
                                        </div>
                                    </div>

                                    <!-- Emulsion Defects (Moved) -->
                                    <div class="grid grid-cols-2 gap-4 pt-4 border-t border-glass-border">
                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Scratches</label>
                                                <span class="slider-value" data-for="scratches"
                                                    data-scrub="scratches">0</span>
                                            </div>
                                            <input type="range" id="scratches" class="studio-slider" min="0" max="100"
                                                step="1" value="0">
                                        </div>
                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Gate Weave</label>
                                                <span class="slider-value" data-for="filmGateWeave"
                                                    data-scrub="filmGateWeave">0</span>
                                            </div>
                                            <input type="range" id="filmGateWeave" class="studio-slider" min="0"
                                                max="100" step="1" value="0">
                                        </div>
                                    </div>

                                    <!-- Date Stamp & Watermark (Moved) -->
                                    <div class="flex gap-2 pt-4 border-t border-glass-border">
                                        <div class="flex-1 bg-glass border border-glass-border rounded p-2">
                                            <div class="flex items-center justify-between mb-2">
                                                <label class="text-xs text-gray-400">Date</label>
                                                <input type="checkbox" id="date-toggle" class="accent-hot-pink">
                                            </div>
                                            <input type="color" id="date-color" value="#ff9900"
                                                class="w-full h-6 bg-transparent cursor-pointer rounded">
                                        </div>
                                        <div class="flex-1 bg-glass border border-glass-border rounded p-2">
                                            <div class="flex items-center justify-between mb-2">
                                                <label class="text-xs text-gray-400">Watermark</label>
                                                <input type="checkbox" id="watermark-toggle" class="accent-hot-pink">
                                            </div>
                                            <input type="text" id="watermark-text" value="Untitled Studio"
                                                class="w-full bg-black/50 border border-glass-border rounded text-[10px] px-1 py-1 text-white focus:border-hot-pink outline-none">
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 4.5. CREATIVE SUB-PANEL (New) -->
                            <div id="fx-creative" class="fx-subpanel hidden">

                                <!-- Selective Color -->
                                <div class="mb-4">
                                    <label
                                        class="text-xs text-hot-pink font-bold mb-3 block uppercase tracking-wider border-b border-white/10 pb-1">Selective
                                        Color</label>

                                    <div class="slider-group mb-4">
                                        <div class="slider-header">
                                            <label>Target Hue</label>
                                            <div class="flex items-center gap-2">
                                                <div id="sel-color-preview"
                                                    class="w-3 h-3 rounded-full bg-red-500 border border-white/20">
                                                </div>
                                                <span class="slider-value" data-for="selColorHue"
                                                    data-scrub="selColorHue">0Â°</span>
                                            </div>
                                        </div>
                                        <!-- Rainbow gradient background for context -->
                                        <input type="range" id="selColorHue" class="studio-slider" min="0" max="360"
                                            step="1" value="0"
                                            style="background: linear-gradient(to right, #f00, #ff0, #0f0, #0ff, #00f, #f0f, #f00);">
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Range</label>
                                                <span class="slider-value" data-for="selColorRange"
                                                    data-scrub="selColorRange">0</span>
                                            </div>
                                            <input type="range" id="selColorRange" class="studio-slider" min="0"
                                                max="180" step="1" value="45">
                                        </div>

                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Feather</label>
                                                <span class="slider-value" data-for="selColorFeather"
                                                    data-scrub="selColorFeather">0.5</span>
                                            </div>
                                            <input type="range" id="selColorFeather" class="studio-slider" min="0"
                                                max="1" step="0.01" value="0.5">
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4 mt-2">
                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Saturation</label>
                                                <span class="slider-value" data-for="selColorSat"
                                                    data-scrub="selColorSat">0</span>
                                            </div>
                                            <input type="range" id="selColorSat" class="studio-slider" min="-100"
                                                max="100" step="1" value="0">
                                        </div>

                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Luminance</label>
                                                <span class="slider-value" data-for="selColorLum"
                                                    data-scrub="selColorLum">0</span>
                                            </div>
                                            <input type="range" id="selColorLum" class="studio-slider" min="-100"
                                                max="100" step="1" value="0">
                                        </div>
                                    </div>
                                </div>

                                <!-- Separator -->
                                <div class="h-px bg-white/10 my-6"></div>

                                <!-- TILT SHIFT -->
                                <h3 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-4">Tilt-Shift
                                </h3>

                                <div class="space-y-4">
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Blur Strength</label>
                                            <span class="slider-value" data-for="tiltShiftBlur"
                                                data-scrub="tiltShiftBlur">0</span>
                                        </div>
                                        <input type="range" id="tiltShiftBlur" class="studio-slider" min="0" max="50"
                                            step="1" value="0">
                                    </div>

                                    <div class="grid grid-cols-3 gap-2">
                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label class="text-[0.6rem]">Position</label>
                                                <span class="slider-value" data-for="tiltShiftPos"
                                                    data-scrub="tiltShiftPos">0.5</span>
                                            </div>
                                            <input type="range" id="tiltShiftPos" class="studio-slider" min="0" max="1"
                                                step="0.01" value="0.5">
                                        </div>
                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label class="text-[0.6rem]">Width</label>
                                                <span class="slider-value" data-for="tiltShiftFocusWidth"
                                                    data-scrub="tiltShiftFocusWidth">0.4</span>
                                            </div>
                                            <input type="range" id="tiltShiftFocusWidth" class="studio-slider" min="0"
                                                max="1" step="0.01" value="0.4">
                                        </div>
                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label class="text-[0.6rem]">Fade</label>
                                                <span class="slider-value" data-for="tiltShiftGradient"
                                                    data-scrub="tiltShiftGradient">0.2</span>
                                            </div>
                                            <input type="range" id="tiltShiftGradient" class="studio-slider" min="0"
                                                max="1" step="0.01" value="0.2">
                                        </div>
                                    </div>
                                </div>
                            </div>


                            <!-- 6. FRAME SUB-PANEL (Consolidated) -->
                            <div id="fx-frame" class="fx-subpanel hidden">
                                <div class="flex items-center justify-between mb-4 border-b border-glass-border pb-2">
                                    <label class="text-sm font-semibold text-gray-300">Frame Border</label>
                                    <div class="flex items-center gap-2">
                                        <span class="text-xs text-gray-500">Enable</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="border-toggle" class="sr-only peer">
                                            <div
                                                class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-hot-pink rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-hot-pink">
                                            </div>
                                        </label>
                                    </div>
                                </div>

                                <div id="border-controls"
                                    class="space-y-4 transition-opacity duration-300 opacity-50 pointer-events-none mb-6">
                                    <!-- Border Width -->
                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Thickness</label>
                                            <span class="slider-value" data-for="borderWidth" data-scrub="borderWidth"
                                                id="border-width-val">0%</span>
                                        </div>
                                        <input type="range" id="borderWidth" class="studio-slider" min="0" max="25"
                                            step="0.5" value="0">
                                    </div>

                                    <!-- Border Color -->
                                    <div class="bg-glass border border-glass-border rounded-lg p-3">
                                        <label
                                            class="text-xs text-gray-400 mb-2 block uppercase tracking-tighter font-bold">Border
                                            Tone</label>
                                        <div class="flex gap-2">
                                            <input type="color" id="borderColor" value="#ffffff"
                                                class="w-10 h-10 rounded-lg cursor-pointer border-0 bg-transparent p-0">
                                            <div class="flex-1 grid grid-cols-5 gap-1">
                                                <button
                                                    class="h-10 rounded bg-white border border-gray-600 border-color-preset hover:scale-105 transition-transform"
                                                    data-color="#ffffff" title="Classic White"></button>
                                                <button
                                                    class="h-10 rounded bg-black border border-gray-600 border-color-preset hover:scale-105 transition-transform"
                                                    data-color="#000000" title="Matte Black"></button>
                                                <button
                                                    class="h-10 rounded bg-[#f5f5f5] border border-gray-600 border-color-preset hover:scale-105 transition-transform"
                                                    data-color="#f5f5f5" title="Off-White"></button>
                                                <button
                                                    class="h-10 rounded bg-[#1a1a1a] border border-gray-600 border-color-preset hover:scale-105 transition-transform"
                                                    data-color="#1a1a1a" title="Dark Gray"></button>
                                                <button
                                                    class="h-10 rounded bg-[#ed2788] border border-gray-600 border-color-preset hover:scale-105 transition-transform"
                                                    data-color="#ed2788" title="Hot Pink"></button>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Gallery Frame (Moved from Atmosphere) -->
                                <div class="pt-4 border-t border-glass-border">
                                    <div class="flex items-center justify-between">
                                        <label class="text-sm font-semibold text-gray-300">Gallery Mode</label>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" id="gallery-frame-toggle" class="sr-only peer">
                                            <div
                                                class="w-9 h-5 bg-glass-border peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-white">
                                            </div>
                                        </label>
                                    </div>
                                    <div id="gallery-options"
                                        class="hidden mt-4 space-y-3 pl-2 border-l-2 border-white/20">
                                        <div class="flex items-center justify-between">
                                            <span class="text-xs text-gray-400">Mount Color</span>
                                            <button id="gallery-theme-btn"
                                                class="text-[10px] px-3 py-1 rounded bg-white text-black font-bold uppercase">White</button>
                                        </div>
                                    </div>
                                </div> <!-- End gallery pt-4 wrapper -->
                            </div> <!-- End fx-frame -->
                        </div> <!-- End effects-panel -->
                    </div> <!-- End p-4 space-y-6 -->
                </div> <!-- End accordion-content -->
            </div> <!-- End accordion-item (FX) -->

            <!-- TRANSFORM ACCORDION ITEM (Renamed from Crop) -->
            <div class="accordion-item" data-section="transform">
                <button class="accordion-header">
                    <span class="indicator">[ + ]</span> <span class="label">TRANSFORM</span>
                </button>
                <div class="accordion-content">
                    <div class="p-4 space-y-6">
                        <div id="crop-panel" class="panel">
                            <div class="flex flex-wrap gap-4">
                                <div>
                                    <label class="text-xs text-gray-500 mb-2 block">Aspect Ratio</label>
                                    <div class="flex flex-wrap gap-1">
                                        <button class="aspect-btn active" data-aspect="free">Free</button>
                                        <button class="aspect-btn" data-aspect="original">Original</button>
                                        <button class="aspect-btn" data-aspect="1:1">1:1</button>
                                        <button class="aspect-btn" data-aspect="4:3">4:3</button>
                                        <button class="aspect-btn" data-aspect="16:9">16:9</button>
                                        <button class="aspect-btn" data-aspect="3:2">3:2</button>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500 mb-2 block">Rotate</label>
                                    <div class="flex gap-2">
                                        <button id="rotate-ccw-btn"
                                            class="p-2 rounded-lg bg-glass hover:bg-glass-border" title="Rotate Left">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                        </button>
                                        <input type="range" id="rotation" class="studio-slider w-32" min="-45" max="45"
                                            step="0.5" value="0">
                                        <button id="rotate-cw-btn" class="p-2 rounded-lg bg-glass hover:bg-glass-border"
                                            title="Rotate Right">
                                            <svg class="w-5 h-5 transform scale-x-[-1]" fill="none"
                                                stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <label class="text-xs text-gray-500 mb-2 block">Flip</label>
                                    <div class="flex gap-2">
                                        <button id="flip-h-btn" class="p-2 rounded-lg bg-glass hover:bg-glass-border"
                                            title="Flip Horizontal">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                            </svg>
                                        </button>
                                        <button id="flip-v-btn" class="p-2 rounded-lg bg-glass hover:bg-glass-border"
                                            title="Flip Vertical">
                                            <svg class="w-5 h-5 transform rotate-90" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="flex gap-2 ml-auto">
                                    <button id="crop-reset-btn"
                                        class="px-4 py-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass">Reset</button>
                                    <button id="crop-apply-btn"
                                        class="px-4 py-2 rounded-lg bg-hot-pink text-white font-semibold hover:bg-hot-pink/80">Apply
                                        Crop</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- PRESETS ACCORDION ITEM -->
            <div class="accordion-item" data-section="presets">
                <button class="accordion-header">
                    <span class="indicator">[ + ]</span> <span class="label">PRESETS</span>
                </button>
                <div class="accordion-content">
                    <div class="p-4 space-y-6">
                        <div id="presets-panel" class="panel h-full flex flex-col overflow-hidden">
                            <!-- Categorized Browser -->
                            <div id="preset-browser" class="flex-1 overflow-y-auto space-y-1 pr-1 custom-scrollbar">

                                <!-- Essential / User -->
                                <div class="preset-group expanded" data-group="essentials">
                                    <div
                                        class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                                        <span
                                            class="text-xs font-bold tracking-widest text-hot-pink uppercase">Essentials</span>
                                        <svg class="w-3 h-3 transition-transform" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <div class="group-content p-2 grid grid-cols-2 gap-2">
                                        <button class="preset-category active" data-category="all">All
                                            Films</button>
                                        <button class="preset-category" data-category="favorites">â­
                                            Favorites</button>
                                        <button class="preset-category" data-category="custom">My
                                            Presets</button>
                                        <a href="preset_catalog.html" target="_blank"
                                            class="px-3 py-1 rounded-lg bg-white/5 text-gray-400 text-xs font-semibold hover:bg-white/10 hover:text-white flex items-center justify-center gap-1 transition-all decoration-0"
                                            title="Open PDF Catalog">
                                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                                                </path>
                                            </svg>
                                            Catalog
                                        </a>
                                        <button id="save-preset-btn"
                                            class="px-3 py-1 rounded-lg bg-hot-pink/20 text-hot-pink text-xs font-semibold hover:bg-hot-pink/30">+
                                            Save New</button>
                                    </div>
                                </div>

                                <!-- Major Brands -->
                                <div class="preset-group" data-group="brands">
                                    <div
                                        class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                                        <span class="text-xs font-bold tracking-widest text-moonstone uppercase">Major
                                            Brands</span>
                                        <svg class="w-3 h-3 transition-transform" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                                        <button class="preset-category" data-category="kodak">Kodak</button>
                                        <button class="preset-category" data-category="fuji">Fuji</button>
                                        <button class="preset-category" data-category="ilford">Ilford</button>
                                        <button class="preset-category" data-category="cinestill">Cinestill</button>
                                        <button class="preset-category" data-category="agfa">Agfa</button>
                                        <button class="preset-category" data-category="polaroid">Polaroid</button>
                                        <button class="preset-category" data-category="rollei">Rollei</button>
                                        <button class="preset-category" data-category="lomography">Lomo</button>
                                        <button class="preset-category" data-category="konica">Konica</button>
                                        <button class="preset-category" data-category="yashica">Yashica</button>
                                        <button class="preset-category" data-category="adox">Adox</button>
                                        <button class="preset-category" data-category="harman">Harman</button>
                                    </div>
                                </div>

                                <!-- Indie & Boutique -->
                                <div class="preset-group" data-group="indie">
                                    <div
                                        class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                                        <span class="text-xs font-bold tracking-widest text-moonstone uppercase">Indie
                                            &
                                            Boutique</span>
                                        <svg class="w-3 h-3 transition-transform" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                                        <button class="preset-category" data-category="orwo">Orwo</button>
                                        <button class="preset-category" data-category="svema">Svema</button>
                                        <button class="preset-category" data-category="fomapan">Fomapan</button>
                                        <button class="preset-category" data-category="lucky">Lucky</button>
                                        <button class="preset-category" data-category="revolog">Revolog</button>
                                        <button class="preset-category" data-category="fpp">FPP</button>
                                        <button class="preset-category" data-category="yodica">Yodica</button>
                                        <button class="preset-category" data-category="dubblefilm">Dubble</button>
                                        <button class="preset-category" data-category="washi">Washi</button>
                                        <button class="preset-category" data-category="kono">Kono!</button>
                                        <button class="preset-category" data-category="reflx">Reflx</button>
                                        <button class="preset-category" data-category="flicfilm">FlicFilm</button>
                                        <button class="preset-category" data-category="karmir">Karmir</button>
                                        <button class="preset-category" data-category="hanalogital">Hanalogital</button>
                                    </div>
                                </div>

                                <!-- Special Collections -->
                                <div class="preset-group" data-group="specials">
                                    <div
                                        class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                                        <span
                                            class="text-xs font-bold tracking-widest text-moonstone uppercase">Curated</span>
                                        <svg class="w-3 h-3 transition-transform" fill="none" stroke="currentColor"
                                            viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                                        <button class="preset-category" data-category="mrnegative">Mr.
                                            Negative</button>
                                        <button class="preset-category" data-category="berlin">Berlin</button>
                                        <button class="preset-category" data-category="handsonfilm">HandsOnFilm</button>
                                        <button class="preset-category" data-category="cinemot">CineMot</button>
                                        <button class="preset-category" data-category="candido">Candido</button>
                                        <button class="preset-category" data-category="analogue">Analogue</button>
                                    </div>
                                </div>

                                <!-- Collections -->
                                <div class="preset-group" data-group="collections">
                                    <div
                                        class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                                        <span
                                            class="text-xs font-bold tracking-widest text-emerald-400 uppercase">Archives</span>
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                                        <button class="preset-category" data-category="vintage">Vintage</button>
                                        <button class="preset-category" data-category="obscure">Obscure</button>
                                    </div>
                                </div>

                                <!-- Creative Styles -->
                                <div class="preset-group" data-group="styles">
                                    <div
                                        class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                                        <span
                                            class="text-xs font-bold tracking-widest text-purple-400 uppercase">Creative</span>
                                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                    <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                                        <button class="preset-category" data-category="modern">Modern</button>
                                        <button class="preset-category" data-category="moody">Moody</button>
                                        <button class="preset-category" data-category="dreamy">Dreamy</button>
                                        <button class="preset-category" data-category="cinema">Cinema</button>
                                        <button class="preset-category" data-category="monochrome">Monochrome</button>
                                        <button class="preset-category"
                                            data-category="experimental">Experimental</button>
                                        <button class="preset-category" data-category="muse">Muse</button>
                                    </div>
                                </div>
                            </div>

                            <!-- 3D Preset Wheel -->
                            <div id="preset-wheel-container"
                                class="relative flex-1 perspective-1000 overflow-hidden my-2">
                                <!-- Center Marker Line -->
                                <div
                                    class="absolute top-4 bottom-4 left-1/2 w-0.5 bg-gradient-to-b from-transparent via-hot-pink/50 to-transparent z-20 transform -translate-x-1/2 pointer-events-none">
                                </div>

                                <div id="preset-wheel"
                                    class="wheel-scroll-area flex items-center px-[50%] gap-4 h-full overflow-x-auto scroll-snap-x snap-mandatory scrollbar-hide py-4">
                                    <!-- Presets injected here -->
                                </div>
                            </div>

                            <!-- Active Preset Name Overlay -->
                            <div id="active-preset-name"
                                class="text-center text-moonstone font-bold text-lg h-8 flex-shrink-0 transition-all opacity-0">
                            </div>

                            <!-- Preset Strength Slider -->
                            <div id="preset-strength-container"
                                class="mt-2 pt-2 border-t border-glass-border hidden flex-shrink-0 bg-glass-panel">
                                <div class="flex items-center gap-4">
                                    <span class="text-xs text-gray-400 uppercase tracking-wider">Strength</span>
                                    <input type="range" id="preset-strength" class="studio-slider flex-1" min="0"
                                        max="100" value="100">
                                    <span id="preset-strength-value"
                                        class="text-sm text-moonstone font-semibold w-12 text-right">100%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- MASK ACCORDION ITEM -->
            <div class="accordion-item" data-section="mask">
                <button class="accordion-header">
                    <span class="indicator">[ + ]</span> <span class="label">MASK</span>
                </button>
                <div class="accordion-content">
                    <div class="p-4 space-y-6">
                        <div id="mask-panel" class="panel">
                            <div class="flex flex-col gap-4">
                                <!-- Manifesto Mode Toggle -->
                                <div
                                    class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-glass-border mb-2 group hover:border-hot-pink transition-all">
                                    <div class="flex flex-col">
                                        <span
                                            class="text-xs font-bold text-hot-pink tracking-widest uppercase">Manifesto
                                            Mode</span>
                                        <span class="text-[10px] text-gray-500 uppercase">Unmask the
                                            interface</span>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input id="manifesto-mode-toggle" type="checkbox" class="sr-only peer">
                                        <div
                                            class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-none border border-white/20 peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-none after:h-5 after:w-5 after:transition-all peer-checked:bg-hot-pink shadow-[4px_4px_0px_rgba(60,162,200,0.3)] peer-checked:shadow-[4px_4px_0px_rgba(255,255,255,0.2)]">
                                        </div>
                                    </label>
                                </div>

                                <!-- Add Mask Button -->
                                <button id="add-mask-btn"
                                    class="w-full py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 4v16m8-8H4" />
                                    </svg>
                                    Shoot better next time
                                </button>

                                <!-- Mask List -->
                                <div id="mask-list" class="space-y-2 max-h-40 overflow-y-auto">
                                    <!-- Mask items injected by JS -->
                                    <div class="text-center py-8">
                                        <div class="text-xs text-hot-pink/40 uppercase tracking-[0.3em] font-bold mb-4">
                                            The
                                            Unmasked Era
                                        </div>
                                        <p class="text-sm text-gray-500 mb-6 italic px-8">"We do not paint
                                            light. We
                                            capture it,
                                            we
                                            process it, and we suffer the consequences."</p>
                                        <a href="manifesto.html"
                                            class="inline-block px-6 py-2 border border-hot-pink/20 text-hot-pink text-[10px] font-bold uppercase tracking-widest hover:bg-hot-pink/10 transition-all rounded">
                                            Read the Manifesto
                                        </a>
                                    </div>
                                </div>

                                <!-- Active Mask Controls (Initially Hidden) -->
                                <div id="mask-controls" class="hidden border-t border-glass-border pt-4 space-y-4">
                                    <div class="flex items-center justify-between">
                                        <span class="text-xs font-semibold text-gray-400">Settings</span>
                                        <button id="delete-mask-btn"
                                            class="text-xs text-red-400 hover:text-red-300">Delete</button>
                                    </div>

                                    <div class="flex items-center justify-between">
                                        <label class="text-xs text-gray-300">Show Overlay</label>
                                        <input type="checkbox" id="mask-overlay-toggle"
                                            class="form-checkbox h-4 w-4 text-hot-pink rounded border-gray-600 bg-white/10 focus:ring-0 focus:ring-offset-0">
                                    </div>

                                    <div class="flex items-center justify-between">
                                        <label class="text-xs text-gray-300">Invert</label>
                                        <input type="checkbox" id="mask-invert"
                                            class="w-4 h-4 rounded bg-white/10 border-white/20 text-hot-pink focus:ring-hot-pink">
                                    </div>

                                    <div class="space-y-3 pt-2 border-t border-glass-border">
                                        <div class="text-xs font-semibold text-gray-400">Transform</div>

                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>X</label>
                                                <span class="slider-value" data-for="mask-x"
                                                    data-scrub="mask-x">0.5</span>
                                            </div>
                                            <input type="range" id="mask-x" class="studio-slider" min="0" max="1"
                                                step="0.01" value="0.5">
                                        </div>

                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Y</label>
                                                <span class="slider-value" data-for="mask-y"
                                                    data-scrub="mask-y">0.5</span>
                                            </div>
                                            <input type="range" id="mask-y" class="studio-slider" min="0" max="1"
                                                step="0.01" value="0.5">
                                        </div>

                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Radius</label>
                                                <span class="slider-value" data-for="mask-radius"
                                                    data-scrub="mask-radius">0.3</span>
                                            </div>
                                            <input type="range" id="mask-radius" class="studio-slider" min="0" max="1"
                                                step="0.01" value="0.3">
                                        </div>

                                        <div class="slider-group">
                                            <div class="slider-header">
                                                <label>Rotation</label>
                                                <span class="slider-value" data-for="mask-rotation"
                                                    data-scrub="mask-rotation">0</span>
                                            </div>
                                            <input type="range" id="mask-rotation" class="studio-slider" min="0"
                                                max="360" step="1" value="0">
                                        </div>
                                    </div>

                                    <div class="slider-group">
                                        <div class="slider-header">
                                            <label>Feather</label>
                                            <span class="slider-value" data-for="mask-feather"
                                                data-scrub="mask-feather">0.2</span>
                                        </div>
                                        <input type="range" id="mask-feather" class="studio-slider" min="0" max="1"
                                            step="0.01" value="0.2">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
        </div>
        </div> <!-- End of Accordion Container -->

        </div>
        </div>
        </div> <!-- End of Accordion Container -->
    </aside>

    <!-- ========== COMMAND BAR (Fixed Footer) ========== -->
    <footer id="command-bar"
        class="fixed bottom-0 left-0 right-0 h-12 bg-[#141414]/95 backdrop-blur border-t border-white/10 z-[100] flex items-center justify-between px-4 pb-[env(safe-area-inset-bottom)]">

        <!-- Left: Undo/Redo & History -->
        <div class="flex items-center gap-2">
            <button id="undo-btn"
                class="p-2 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
                title="Undo (Ctrl+Z)" disabled>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </button>
            <button id="redo-btn"
                class="p-2 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors disabled:opacity-30 disabled:cursor-not-allowed"
                title="Redo (Ctrl+Shift+Z)" disabled>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>
            <div class="w-px h-6 bg-white/10 mx-2"></div>
            <button id="toggle-history-btn"
                class="p-2 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors hidden sm:block"
                title="View History List">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </button>
        </div>

        <!-- Right: Actions -->
        <div class="flex items-center gap-3">
            <button id="reset-btn"
                class="p-2 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                title="Reset All Adjustments">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </button>

            <button id="settings-btn"
                class="p-2 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                title="Export Settings">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
            </button>

            <div class="theme-picker-wrapper">
                <button id="theme-picker-btn"
                    class="p-2 rounded hover:bg-white/10 text-gray-400 hover:text-white transition-colors"
                    title="Theme Picker">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485" />
                    </svg>
                </button>
                <div id="theme-drawer" class="theme-drawer">
                    <div class="theme-swatch" data-theme="kodak" data-label="KODAK"
                        style="background: linear-gradient(135deg, #FFC700, #FF9900);"></div>
                    <div class="theme-swatch" data-theme="braun" data-label="BRAUN"
                        style="background: linear-gradient(135deg, #E5E5E5, #D1D1D1);"></div>
                    <div class="theme-swatch" data-theme="phosphor" data-label="PHOSPHOR"
                        style="background: linear-gradient(135deg, #4AF626, #2C8F1B);"></div>
                    <div class="theme-swatch" data-theme="safelight" data-label="SAFELIGHT"
                        style="background: linear-gradient(135deg, #FF0000, #660000);"></div>
                    <div class="theme-swatch" data-theme="cyanotype" data-label="CYANOTYPE"
                        style="background: linear-gradient(135deg, #7FDBFF, #0074D9);"></div>
                    <div class="theme-swatch" data-theme="vapor" data-label="VAPOR"
                        style="background: linear-gradient(135deg, #FF0099, #BD00FF, #00F0FF);"></div>
                </div>
            </div>

            <div class="h-6 w-px bg-white/10 mx-1"></div>

            <button id="main-export-btn"
                class="px-4 py-1.5 rounded text-white text-sm font-bold tracking-wide transition-all disabled:opacity-50 disabled:grayscale"
                style="background: var(--gradient-primary); box-shadow: 0 0 15px var(--hot-pink-glow);" disabled
                data-cipher="EXPORT">
                EXPORT
            </button>
        </div>
    </footer>

    <!-- Brand Credit Footer -->
    <div class="brand-credit">
        <span class="brand-credit-text">Untitled Studio // developed by <span
                class="brand-credit-author">mhs</span></span>
    </div>
    </aside>


    <!-- Export Progress Modal (Enhanced) -->
    <div id="export-modal"
        class="fixed inset-0 z-[100] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div
            class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-[28rem] max-w-[95vw] max-h-[85vh] overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white">Exporting</h3>
                <span id="export-eta" class="text-sm text-gray-400">Calculating...</span>
            </div>

            <!-- Overall Progress -->
            <div class="mb-4">
                <!-- Progress Bar -->
                <div
                    class="h-4 bg-midnight rounded-sm overflow-hidden film-progress-strip border-y border-white/5 relative">
                    <div id="export-overall-bar"
                        class="h-full bg-gradient-to-r from-moonstone to-hot-pink transition-all duration-300 opacity-80"
                        style="width: 0%"></div>
                </div>
            </div>

            <!-- Image Queue (scrollable) -->
            <div id="export-queue" class="flex-1 overflow-y-auto space-y-2 max-h-64 scrollbar-hide mb-4">
                <!-- Image items will be inserted here dynamically -->
            </div>

            <!-- Current Status -->
            <div class="text-center py-3 border-t border-glass-border">
                <p id="export-status" class="text-sm text-gray-400">Preparing export...</p>
            </div>

            <!-- Cancel Button -->
            <button id="export-cancel-btn"
                class="w-full py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-all">
                Cancel Export
            </button>
        </div>
    </div>

    <!-- Batch Export Modal -->
    <div id="batch-export-modal"
        class="fixed inset-0 z-[100] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-96 max-w-[90vw]">
            <h3 class="text-lg font-bold mb-4">Batch Export</h3>
            <p class="text-sm text-gray-400 mb-6">How do you want to save your edited photos?</p>

            <div class="space-y-3">
                <button id="batch-mode-zip"
                    class="w-full text-left p-4 rounded-xl bg-glass hover:bg-glass-border border border-glass-border transition-all group">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-lg bg-indigo-500/20 text-indigo-400 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <div class="font-semibold text-white">ZIP Archive</div>
                            <div class="text-xs text-gray-500">One single compressed file</div>
                        </div>
                    </div>
                </button>

                <button id="batch-mode-waterfall"
                    class="w-full text-left p-4 rounded-xl bg-glass hover:bg-glass-border border border-glass-border transition-all group">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-lg bg-emerald-500/20 text-emerald-400 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                            </svg>
                        </div>
                        <div>
                            <div class="font-semibold text-white">Individual Files</div>
                            <div class="text-xs text-gray-500">Save separately (Waterfall)</div>
                        </div>
                    </div>
                </button>
            </div>

            <button id="batch-modal-close"
                class="w-full mt-6 py-2 text-sm text-gray-500 hover:text-white transition-colors">Cancel</button>
        </div>
    </div>

    <!-- Save Preset Modal -->
    <div id="save-preset-modal"
        class="fixed inset-0 z-[110] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-[24rem] max-w-[95vw]">
            <h3 class="text-lg font-bold text-white mb-4">Save Preset</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-xs text-gray-500 mb-2 uppercase tracking-wider">Preset Name</label>
                    <input type="text" id="preset-name-input"
                        class="w-full bg-white/5 border border-glass-border rounded-xl px-4 py-3 text-white focus:outline-none focus:border-hot-pink transition-all"
                        placeholder="Enter preset name...">
                </div>
                <div class="grid grid-cols-2 gap-3 mt-6">
                    <button id="save-preset-cancel"
                        class="py-3 px-4 rounded-xl bg-white/5 text-white text-sm font-semibold hover:bg-white/10 transition-all">Cancel</button>
                    <button id="save-preset-confirm"
                        class="py-3 px-4 rounded-xl bg-hot-pink text-white text-sm font-semibold hover:bg-hot-pink/90 transition-all">Save
                        Preset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Settings Modal -->
    <div id="export-settings-modal"
        class="fixed inset-0 z-[110] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-[28rem] max-w-[95vw]">
            <h3 class="text-lg font-bold text-white mb-6 font-mono">EXPORT SETTINGS</h3>

            <div class="space-y-6">
                <!-- Format -->
                <div class="space-y-3">
                    <label class="block text-[10px] text-gray-500 uppercase tracking-[0.2em]">File Format</label>
                    <select id="export-format"
                        class="w-full bg-white/5 border border-glass-border rounded-xl px-4 py-3 text-white appearance-none focus:outline-none focus:border-hot-pink">
                        <option value="jpeg">JPEG (Universal)</option>
                        <option value="png">PNG (Lossless)</option>
                    </select>
                </div>

                <!-- Resolution -->
                <div class="space-y-3">
                    <label class="block text-[10px] text-gray-500 uppercase tracking-[0.2em]">Resolution</label>
                    <select id="export-resolution"
                        class="w-full bg-white/5 border border-glass-border rounded-xl px-4 py-3 text-white appearance-none focus:outline-none focus:border-hot-pink">
                        <option value="original">Original (Full Quality)</option>
                        <option value="2048">2K (2048px)</option>
                        <option value="1080">HD (1080px)</option>
                        <option value="custom">Custom Width</option>
                    </select>
                </div>

                <!-- Custom Width (Hidden by default) -->
                <div id="custom-resolution-group" class="space-y-3 hidden">
                    <label class="block text-[10px] text-gray-500 uppercase tracking-[0.2em]">Width (px)</label>
                    <input type="number" id="export-custom-width"
                        class="w-full bg-white/5 border border-glass-border rounded-xl px-4 py-2 text-white font-mono"
                        value="1920">
                </div>

                <!-- Quality -->
                <div class="space-y-3">
                    <div class="flex justify-between items-center">
                        <label class="text-[10px] text-gray-500 uppercase tracking-[0.2em]">JPEG Quality</label>
                        <span id="export-quality-value" class="text-sm font-mono text-hot-pink">95%</span>
                    </div>
                    <input type="range" id="export-quality" class="studio-slider" min="50" max="100" value="95">
                </div>

                <!-- Metadata -->
                <div class="flex items-center justify-between p-4 bg-white/5 rounded-xl border border-glass-border">
                    <div class="flex items-center gap-3">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span class="text-sm text-white">Preserve Metadata (EXIF)</span>
                    </div>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input id="export-exif" type="checkbox" checked class="sr-only peer">
                        <div
                            class="w-11 h-6 bg-white/10 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-hot-pink">
                        </div>
                    </label>
                </div>
            </div>

            <div class="flex items-center justify-between border-t border-glass-border pt-6 mt-8">
                <button id="export-settings-cancel"
                    class="text-gray-400 hover:text-white transition-colors text-sm font-mono uppercase tracking-widest">Cancel</button>

                <div class="flex gap-4">
                    <button id="export-settings-save"
                        class="hidden text-sm font-semibold text-white/50 hover:text-white">Close</button>
                    <button id="modal-export-action-btn"
                        class="px-6 py-2 rounded-lg bg-hot-pink hover:bg-hot-pink/90 text-white font-bold transition-all shadow-[0_0_15px_rgba(237,39,136,0.2)] hover:shadow-[0_0_20px_rgba(237,39,136,0.4)]">
                        EXPORT IMAGE
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Dynamic Startup Toast -->
    <div id="startup-toast"
        class="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-[200] pointer-events-none transition-opacity duration-1000">
        <!-- Content injected by JS -->
    </div>

    <!-- Core Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="js/shaders.js?v=16"></script>
    <script src="js/presets.js?v=14"></script>
    <script src="js/storage.js?v=14"></script>
    <script src="js/histogram.js?v=14"></script>
    <script src="js/history.js"></script>
    <!-- Tools -->
    <script src="js/tone-curve.js"></script>
    <script src="js/color-wheels.js"></script>
    <script src="js/vectorscope.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/exifreader/dist/exif-reader.min.js"></script>
    <script src="js/webgl-engine.js"></script>
    <script src="js/terminal-viewer.js"></script>
    <script src="js/export-manager.js"></script>
    <script src="js/crop-tool.js?v=14"></script>
    <script src="js/gesture-handler.js?v=14"></script>
    <script src="js/raw-decoder.js?v=14"></script>
    <script src="js/lut-exporter.js?v=14"></script>
    <!-- script src="js/textures.js?v=14"></script> -->
    <script src="js/audio-engine.js?v=1"></script>
    <script src="js/app.js?v=16"></script>

    <!-- Global CRT Overlay -->
    <div id="crt-overlay"
        class="pointer-events-none fixed inset-0 z-[999] opacity-0 transition-opacity duration-500 hidden"></div>

    <!-- Terminal Metadata Viewer Overlay -->
    <div id="terminal-viewer-overlay" class="fixed inset-0 z-[101] hidden bg-black/20 pointer-events-none">
        <!-- Content will be injected by TerminalViewer.js -->
    </div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js?v=15')
                    .then(reg => {
                        console.log('âœ“ Service Worker registered');
                        // Force update
                        reg.update();
                    })
                    .catch(err => console.error('âœ— SW registration failed:', err));
            });
        }
    </script>
    <!-- ========== MANIFESTO MODAL ========== -->
    <div id="manifesto-modal" class="fixed inset-0 z-[100] hidden">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/80 backdrop-blur-xl transition-opacity opacity-0" id="manifesto-backdrop">
        </div>

        <!-- Content -->
        <div class="absolute inset-0 flex items-center justify-center p-4 pointer-events-none opacity-0 scale-95 transition-all duration-300"
            id="manifesto-content-wrapper">
            <div
                class="bg-[#121212] border border-[#3CA2C8]/30 w-full max-w-2xl max-h-[90vh] overflow-y-auto rounded-none pointer-events-auto shadow-[0_0_50px_rgba(60,162,200,0.1)] relative">

                <!-- Terminal Header -->
                <div
                    class="sticky top-0 bg-[#121212] border-b border-[#3CA2C8]/30 p-2 flex justify-between items-center z-10">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-[#ed2788]"></div>
                        <span class="font-mono text-xs text-[#3CA2C8] tracking-widest">MANIFESTO.MD</span>
                    </div>
                    <button id="close-manifesto-btn"
                        class="text-[#3CA2C8] hover:text-white font-mono text-xl leading-none px-2">&times;</button>
                </div>

                <!-- Text Content -->
                <div
                    class="p-8 font-mono text-gray-300 space-y-6 text-sm leading-relaxed selection:bg-[#ed2788] selection:text-white">
                    <h1 class="text-xl font-bold text-white mb-8 tracking-tighter border-b border-gray-800 pb-4">
                        THE MANIFESTO OF THE UNMASKED<br>
                        <span class="text-xs font-normal text-[#ed2788] opacity-80">"Global Adjustments Only. No Hiding.
                            No Lies."</span>
                    </h1>

                    <div class="space-y-2">
                        <h2 class="text-[#3CA2C8] font-bold">I. THE ATTEMPT</h2>
                        <p>We sought to implement gl_StencilFunc. We tried to bind Framebuffers for "Subject Selection."
                            We wrote 400 lines of shader code to calculate a "Gaussian Blur" for a soft-feathered brush.
                            And what did we get?</p>
                        <ul class="list-disc list-inside text-[#ed2788]/80 text-xs ml-4">
                            <li>CONTEXT_LOST_WEBGL</li>
                            <li>FPS dropped to 4</li>
                            <li>The fan on the Acer Aspire sounded like a jet engine taking off from Halim
                                Perdanakusuma.</li>
                        </ul>
                    </div>

                    <div class="space-y-2">
                        <h2 class="text-[#3CA2C8] font-bold">II. THE REALIZATION</h2>
                        <p>Why did we want masking? To fix mistakes? To brighten a face? To darken a sky? THIS IS
                            DIGICHUD THINKING.</p>
                        <p>When you shoot a roll of Svema traffic surveillance film, do you get to "mask out" the grain?
                            No. You accept the grain. You breathe the grain.</p>
                        <p>When you shoot Kodak Aerochrome, do you get to say "I only want the trees to be pink, not the
                            grass"? No. The chemistry does not care about your feelings. The chemistry converts the
                            entire spectrum.</p>
                    </div>

                    <div class="space-y-2">
                        <h2 class="text-[#3CA2C8] font-bold">III. THE PHILOSOPHY OF THE GLOBAL</h2>
                        <p>Masking is a digital perversion. It creates a lie. It creates an image that never existed.
                        </p>
                        <p class="italic text-white">"Oh, let me just lift the shadows on my face." <span
                                class="text-[#ed2788] not-italic font-bold">COWARDICE.</span></p>
                        <p class="italic text-white">"Let me saturate just the sunset." <span
                                class="text-[#ed2788] not-italic font-bold">WEAKNESS.</span></p>
                        <p>True Film Simulation is holistic. It is a chemical bath that drowns the entire image equally.
                            If the shadows are green, they are green everywhere. If the highlights are blown, they are
                            blown forever.</p>
                        <p>We do not "paint" light. We capture it, we process it, and we suffer the consequences.</p>
                    </div>

                    <div class="space-y-2">
                        <h2 class="text-[#3CA2C8] font-bold">IV. THE TECHNICAL LIMITATION AS ART</h2>
                        <p>The Digichuds will say: "Your app sucks, I can't even brush adjustments."</p>
                        <p>We will say: "The Nvidia 820m prevents us from sinning."</p>
                        <p>We are not limited by hardware. We are protected by it. The 1GB of VRAM is a guardrail
                            against bad taste.</p>
                    </div>

                    <div class="space-y-2">
                        <h2 class="text-[#3CA2C8] font-bold">V. THE DECLARATION</h2>
                        <p>From this day forth, the "Masking Tool" is deprecated. Deleted from the repo. Wiped from the
                            history.</p>
                        <p class="py-2">
                            You want to fix your exposure? Shoot better.<br>
                            You want to change the color of just one object? Buy a paintbrush.<br>
                            You want "Smart Selection"? Go back to Adobe.
                        </p>
                    </div>

                    <div class="border-t border-gray-800 pt-6 mt-8 text-center bg-[#121212]">
                        <p class="text-[#ed2788] font-bold tracking-widest text-lg uppercase">Here, we die like
                            men.<br>We die with Global Saturation -100.<br>We die with the whole frame.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Cipher Reveal Engine -->
    <script src="js/cipher-reveal.js"></script>
    <script src="js/scrubber.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const logo = document.querySelector('.logo');
            const modal = document.getElementById('manifesto-modal');
            const backdrop = document.getElementById('manifesto-backdrop');
            const content = document.getElementById('manifesto-content-wrapper');
            const closeBtn = document.getElementById('close-manifesto-btn');

            function openModal(e) {
                if (e) e.preventDefault();
                modal.classList.remove('hidden');
                // Trigger animation
                setTimeout(() => {
                    backdrop.classList.remove('opacity-0');
                    content.classList.remove('opacity-0', 'scale-95');
                }, 10);
            }

            function closeModal() {
                backdrop.classList.add('opacity-0');
                content.classList.add('opacity-0', 'scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }

            if (logo) {
                logo.addEventListener('click', openModal);
            }

            if (closeBtn) closeBtn.addEventListener('click', closeModal);
            if (backdrop) backdrop.addEventListener('click', closeModal);

            // Close on ESC
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    closeModal();
                }
            });
        });
    </script>
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered:', registration);
                    })
                    .catch(error => {
                        console.log('SW registration failed:', error);
                    });
            });
        }
    </script>
</body>

</html>