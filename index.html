<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#121212">
    <meta name="description" content="Untitled Studio - Professional photo editing PWA with film presets">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <title>Untitled Studio</title>

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="assets/icons/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icons/icon-192.png">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Share+Tech+Mono&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'midnight': '#121212',
                        'glass': 'rgba(30, 30, 30, 0.6)',
                        'glass-border': 'rgba(255, 255, 255, 0.08)',
                        'hot-pink': '#ed2788',
                        'hot-pink-glow': 'rgba(237, 39, 136, 0.4)',
                        'moonstone': '#3CA2C8',
                        'moonstone-glow': 'rgba(60, 162, 200, 0.4)',
                    },
                    fontFamily: {
                        'sans': ['Outfit', 'system-ui', 'sans-serif'],
                    },
                    backdropBlur: {
                        'glass': '12px',
                    }
                }
            }
        }
    </script>

    <!-- Custom Scripts -->
    <script src="js/lut-parser.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body class="bg-midnight text-white font-sans overflow-hidden select-none">

    <!-- ========== BATCH BAR (Top) ========== -->
    <header id="batch-bar"
        class="fixed top-0 left-0 right-0 z-50 h-20 bg-glass backdrop-blur-glass border-b border-glass-border">
        <div class="flex items-center h-full px-4 gap-3">
            <!-- Logo -->
            <div id="studio-logo"
                class="flex items-center gap-2 pr-4 border-r border-glass-border cursor-pointer select-none">
                <div
                    class="w-8 h-8 rounded-lg bg-gradient-to-br from-hot-pink to-moonstone flex items-center justify-center">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                </div>
                <span class="text-lg font-bold tracking-tight hidden sm:block">Untitled Studio</span>
            </div>

            <!-- Thumbnail Queue -->
            <div id="thumbnail-queue" class="flex-1 flex items-center gap-2 overflow-x-auto scrollbar-hide py-2">
                <button id="import-btn"
                    class="flex-shrink-0 w-14 h-14 rounded-xl border-2 border-dashed border-glass-border hover:border-hot-pink hover:bg-hot-pink/10 transition-all duration-300 flex items-center justify-center group"
                    title="Import Images">
                    <svg class="w-6 h-6 text-gray-500 group-hover:text-hot-pink transition-colors" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg>
                </button>
            </div>

            <!-- Toolbar Actions -->
            <div class="flex items-center gap-2 pl-4 border-l border-glass-border">
                <!-- Before/After Toggle -->
                <button id="before-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Hold to see original (B)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                    </svg>
                </button>

                <!-- OLED Toggle -->
                <button id="oled-toggle-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="True Black Mode">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                    </svg>
                </button>

                <!-- Hide UI Toggle -->
                <button id="toggle-ui-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Toggle UI (H)">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                </button>

                <!-- Undo/Redo -->
                <button id="undo-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all disabled:opacity-30"
                    title="Undo (Ctrl+Z)" disabled>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
                    </svg>
                </button>
                <button id="redo-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all disabled:opacity-30"
                    title="Redo (Ctrl+Shift+Z)" disabled>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 10h-10a8 8 0 00-8 8v2M21 10l-6 6m6-6l-6-6" />
                    </svg>
                </button>

                <!-- Reset -->
                <button id="reset-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Reset All">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>

                <!-- Sync/Export moved to bottom bar -->
            </div>

            <!-- Split View Toggle (Centered in Header) -->
            <div
                class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 flex items-center gap-2 bg-glass/80 backdrop-blur-md px-4 py-2 rounded-full border border-glass-border z-[60]">
                <label class="text-xs font-bold text-white/80">SPLIT</label>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="split-view-toggle" class="sr-only peer">
                    <div
                        class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-hot-pink rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-hot-pink">
                    </div>
                </label>
            </div>
        </div>
    </header>

    <!-- ========== MAIN CANVAS AREA ========== -->
    <main
        class="fixed inset-0 pt-20 pb-32 md:pb-72 lg:pb-0 lg:right-[40vw] flex items-center justify-center bg-midnight transition-colors duration-700"
        id="main-stage">
        <div id="canvas-container" class="relative w-full h-full flex items-center justify-center overflow-hidden">
            <canvas id="gl-canvas"
                class="max-w-full max-h-full object-contain shadow-2xl transition-transform duration-200"></canvas>

            <!-- Vibe Overlays (Preview) -->
            <div id="vibe-overlay-container" class="absolute inset-0 pointer-events-none overflow-hidden hidden">
                <div id="date-stamp-preview"
                    class="absolute bottom-8 right-8 text-[#ff9900] font-mono text-xl tracking-widest opacity-80"
                    style="font-family: 'Share Tech Mono', monospace; text-shadow: 0 0 5px #ff4400;">
                    '98 01 28
                </div>
                <div id="watermark-preview"
                    class="absolute bottom-4 right-8 text-white/50 font-sans text-xs tracking-wider uppercase hidden">
                    Untitled Studio
                </div>
            </div>

            <!-- LQIP Export Overlay (hidden by default) -->
            <div id="lqip-overlay" class="hidden">
                <img id="lqip-image" alt="">
                <div class="lqip-progress-ring progress-ring">
                    <svg class="w-24 h-24 transform -rotate-90">
                        <circle class="progress-ring-bg" cx="48" cy="48" r="40" stroke-width="6" fill="none" />
                        <circle id="lqip-progress-fill" class="progress-ring-fill" cx="48" cy="48" r="40"
                            stroke-width="6" fill="none" stroke-dasharray="251.33" stroke-dashoffset="251.33" />
                    </svg>
                    <span id="lqip-progress-text" class="progress-text text-sm">0%</span>
                </div>
            </div>

            <!-- Histogram Overlay -->
            <div id="histogram-container"
                class="absolute top-4 right-4 w-48 rounded-lg overflow-hidden bg-midnight/80 border border-glass-border hidden z-50">
                <canvas id="histogram-canvas" width="192" height="112"></canvas>
                <div class="flex items-center justify-between px-2 py-1.5 border-t border-glass-border">
                    <button id="auto-enhance-btn"
                        class="flex items-center gap-1 px-2 py-1 rounded bg-hot-pink/20 hover:bg-hot-pink/40 text-hot-pink text-[10px] font-bold transition-all"
                        title="Auto-Enhance (Magic Wand)">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path
                                d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
                        </svg>
                        Auto
                    </button>
                    <label class="flex items-center gap-1 text-[10px] text-gray-400 cursor-pointer">
                        <input type="checkbox" id="clipping-toggle" class="accent-hot-pink w-3 h-3">
                        Clip
                    </label>
                </div>
            </div>

        </div>
        </div>



        <!-- Split View Slider Overlay (Hidden by default) -->
        <div id="split-slider-container" class="absolute inset-0 pointer-events-none hidden z-40">
            <input type="range" id="split-slider" min="0" max="1" step="0.001" value="0.5"
                class="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize pointer-events-auto z-50">
            <!-- Visual Divider Line -->
            <div id="split-line"
                class="absolute top-0 bottom-0 w-0.5 bg-white shadow-[0_0_10px_rgba(255,255,255,0.8)] left-1/2 pointer-events-none transition-all duration-75">
                <div
                    class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-8 h-8 bg-white rounded-full shadow-lg flex items-center justify-center text-gray-800">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 9l4-4 4 4m0 6l-4 4-4-4"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Before/After Label -->
        <div id="before-label"
            class="absolute top-4 left-4 px-3 py-1 rounded-lg bg-hot-pink text-white text-sm font-semibold hidden">
            ORIGINAL
        </div>

        <!-- Empty State -->
        <!-- Smart Placeholder -->
        <div id="placeholder-container"
            class="absolute inset-0 flex flex-col items-center justify-center p-8 transition-opacity duration-500 perspective-1000">
            <button id="import-hero-btn"
                class="relative group w-72 h-72 rounded-[32px] transition-all duration-300 transform-style-3d cursor-pointer focus:outline-none"
                title="Import Image">

                <!-- 1. The Glass Core (Background) -->
                <div
                    class="absolute inset-0 rounded-[32px] bg-glass-solid/40 backdrop-blur-xl border border-white/10 shadow-2xl overflow-hidden transition-all duration-300 group-hover:border-white/20 group-hover:bg-glass-solid/50">
                    <!-- CRT Scanlines -->
                    <div class="absolute inset-0 bg-scanlines opacity-30 pointer-events-none mix-blend-overlay">
                    </div>
                    <!-- CRT Noise -->
                    <div
                        class="absolute inset-0 bg-noise opacity-10 pointer-events-none mix-blend-overlay animate-noise">
                    </div>
                    <!-- Chromatic Aberration Glow -->
                    <div
                        class="absolute inset-0 bg-gradient-to-br from-hot-pink/20 to-moonstone/20 opacity-0 group-hover:opacity-100 transition-opacity duration-500 blur-xl">
                    </div>
                </div>

                <!-- 2. Content Layer (Floating) -->
                <div class="absolute inset-0 flex flex-col items-center justify-center z-10 transform translate-z-20">
                    <!-- Plus Icon -->
                    <div class="relative w-20 h-20 flex items-center justify-center mb-6">
                        <div
                            class="absolute inset-0 bg-white/10 rounded-full blur-xl opacity-0 group-hover:opacity-100 transition-opacity duration-500 animate-pulse-slow">
                        </div>
                        <svg class="w-12 h-12 text-white/80 drop-shadow-[0_0_15px_rgba(255,255,255,0.3)] transition-all duration-300 group-hover:text-white group-hover:scale-110"
                            fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="1.5">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                        </svg>
                    </div>

                    <!-- Typography -->
                    <span class="text-xs font-bold text-white/90 tracking-[0.2em] uppercase mb-2 drop-shadow-md">Open
                        Studio</span>
                    <div class="flex items-center gap-2">
                        <div class="w-1.5 h-1.5 rounded-full bg-neon-green animate-pulse"></div>
                        <span class="text-[10px] text-white/50 tracking-wider font-mono">READY</span>
                    </div>
                </div>
            </button>
        </div>

        </div>

        <input type="file" id="file-input" accept="image/*,.json" multiple hidden>
    </main>

    <!-- ========== HISTORY SIDEBAR ========== -->
    <aside id="history-sidebar"
        class="fixed top-20 right-0 w-64 h-[calc(100vh-20rem)] bg-glass backdrop-blur-glass border-l border-glass-border transform translate-x-full transition-transform z-40">
        <div class="flex items-center justify-between p-4 border-b border-glass-border">
            <h3 class="font-semibold text-sm">History</h3>
            <button id="close-history-btn" class="p-1 rounded hover:bg-glass">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
        <div id="history-list" class="overflow-y-auto h-full p-2">
            <!-- History items will be inserted here -->
        </div>
    </aside>

    <!-- ========== BOTTOM ACTION BAR (Mobile Thumb Zone) ========== -->
    <footer id="bottom-action-bar"
        class="fixed bottom-0 left-0 right-0 z-[60] bg-glass backdrop-blur-xl border-t border-glass-border p-4 pb-[env(safe-area-inset-bottom)] flex items-center gap-3 lg:hidden transition-transform duration-300">

        <!-- Sync (Secondary) -->
        <button id="sync-all-btn"
            class="p-4 rounded-xl bg-glass border border-glass-border text-moonstone hover:bg-moonstone/20 transition-all disabled:opacity-40 disabled:grayscale flex-shrink-0"
            title="Sync All">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
            </svg>
        </button>

        <!-- Histogram (Mobile) -->
        <button id="toggle-histogram-mobile-btn"
            class="p-4 rounded-xl bg-glass border border-glass-border text-gray-400 hover:text-white hover:bg-glass-border transition-all flex-shrink-0"
            title="Toggle Histogram">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
            </svg>
        </button>

        <!-- Export (Primary) -->
        <button id="batch-export-btn"
            class="flex-1 py-4 rounded-xl bg-hot-pink hover:bg-hot-pink/90 text-white font-bold text-lg shadow-lg shadow-hot-pink/20 transition-all active:scale-95 disabled:opacity-50 disabled:grayscale flex items-center justify-center gap-2">
            <span>Export</span>
            <span id="batch-count" class="text-xs bg-white/20 px-2 py-0.5 rounded-full font-medium">0</span>
        </button>
    </footer>

    <!-- ========== STUDIO DOCK (Bottom / Sidebar on Desktop) ========== -->
    <aside id="studio-dock"
        class="fixed bottom-[88px] left-0 right-0 lg:top-20 lg:left-auto lg:w-[40vw] lg:h-auto lg:bottom-0 z-50 bg-glass backdrop-blur-glass border-t lg:border-t-0 lg:border-l border-glass-border flex flex-col transition-all duration-500 pb-[env(safe-area-inset-bottom)] lg:pb-0">

        <!-- Tab Navigation -->
        <nav
            class="flex items-center justify-between gap-1 px-4 py-3 border-b border-white/5 overflow-x-auto scrollbar-hide flex-shrink-0">
            <button class="tab-btn active" data-tab="tone">
                <span class="text-xs font-semibold">Tone</span>
            </button>
            <button class="tab-btn" data-tab="curve">
                <span class="text-xs font-semibold">Curve</span>
            </button>
            <button class="tab-btn" data-tab="color">
                <span class="text-xs font-semibold">Color</span>
            </button>
            <button class="tab-btn" data-tab="effects">
                <span class="text-xs font-semibold">FX</span>
            </button>
            <button class="tab-btn" data-tab="crop">
                <span class="text-xs font-semibold">Crop</span>
            </button>
            <button class="tab-btn" data-tab="presets">
                <span class="text-xs font-semibold">Presets</span>
            </button>
            <button class="tab-btn" data-tab="mask">
                <span class="text-xs font-semibold">Mask</span>
            </button>
        </nav>

        <!-- Tab Content -->
        <div class="tab-content flex-1 overflow-y-auto p-6 scrollbar-hide pb-safe">

            <!-- TONE Tab -->
            <div id="tone-panel" class="panel active">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Exposure</label>
                            <span class="slider-value" data-for="exposure">0.00</span>
                        </div>
                        <input type="range" id="exposure" class="studio-slider" min="-2" max="2" step="0.01" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Contrast</label>
                            <span class="slider-value" data-for="contrast">0</span>
                        </div>
                        <input type="range" id="contrast" class="studio-slider" min="-100" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Highlights</label>
                            <span class="slider-value" data-for="highlights">0</span>
                        </div>
                        <input type="range" id="highlights" class="studio-slider" min="-100" max="100" step="1"
                            value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Shadows</label>
                            <span class="slider-value" data-for="shadows">0</span>
                        </div>
                        <input type="range" id="shadows" class="studio-slider" min="-100" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Whites</label>
                            <span class="slider-value" data-for="whites">0</span>
                        </div>
                        <input type="range" id="whites" class="studio-slider" min="-100" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Blacks</label>
                            <span class="slider-value" data-for="blacks">0</span>
                        </div>
                        <input type="range" id="blacks" class="studio-slider" min="-100" max="100" step="1" value="0">
                    </div>
                </div>
            </div>

            <!-- CURVE Tab -->
            <div id="curve-panel" class="panel hidden">
                <div class="flex gap-4">
                    <div class="flex-shrink-0">
                        <div class="flex gap-1 mb-2">
                            <button class="curve-channel active" data-channel="rgb">RGB</button>
                            <button class="curve-channel" data-channel="r">R</button>
                            <button class="curve-channel" data-channel="g">G</button>
                            <button class="curve-channel" data-channel="b">B</button>
                            <button id="reset-curve-btn"
                                class="ml-2 px-2 py-1 text-xs text-gray-400 hover:text-white">Reset</button>
                        </div>
                        <svg id="tone-curve-svg"
                            class="w-48 h-48 bg-midnight/50 rounded-lg border border-glass-border cursor-crosshair"></svg>
                    </div>
                    <div class="flex-1 text-sm text-gray-400">
                        <p class="mb-2">Drag points to adjust tones:</p>
                        <ul class="list-disc list-inside text-xs space-y-1">
                            <li>Lift shadows for fade</li>
                            <li>S-curve for contrast</li>
                            <li>Inverted for negative</li>
                        </ul>
                    </div>
                </div>
                <!-- Controls -->
                <div class="flex justify-center gap-4 mt-2">
                    <button id="curve-add-point-btn" class="px-4 py-2 bg-glass rounded hover:bg-glass-border">
                        <span class="text-hot-pink font-bold text-lg">+</span> <span class="text-xs">Add Point</span>
                    </button>
                    <button id="curve-delete-point-btn"
                        class="px-4 py-2 bg-glass rounded hover:bg-glass-border disabled:opacity-50" disabled>
                        <span class="text-red-500 font-bold text-lg">ðŸ—‘</span> <span class="text-xs">Delete</span>
                    </button>
                </div>
            </div>

            <!-- COLOR Tab -->
            <div id="color-panel" class="panel hidden">
                <!-- Custom LUT -->
                <div class="mb-6 pb-4 border-b border-glass-border">
                    <div class="flex items-center justify-between mb-3">
                        <label class="text-sm font-semibold text-gray-300">3D LUT (.cube)</label>
                        <div class="flex gap-2">
                            <button id="remove-lut-btn"
                                class="text-xs text-red-400 hover:text-red-300 hidden">Remove</button>
                            <button id="import-lut-btn"
                                class="text-xs bg-glass hover:bg-glass-border px-2 py-1 rounded text-moonstone">+
                                Import</button>
                            <input type="file" id="lut-input" accept=".cube" hidden>
                        </div>
                    </div>
                    <div id="lut-controls" class="hidden">
                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Opacity</label>
                                <span class="slider-value" data-for="lutOpacity">1.0</span>
                            </div>
                            <input type="range" id="lutOpacity" class="studio-slider" min="0" max="100" step="1"
                                value="100">
                        </div>
                        <div id="lut-name" class="text-[10px] text-gray-500 mt-1 truncate"></div>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Temperature</label>
                            <span class="slider-value" data-for="temperature">0</span>
                        </div>
                        <input type="range" id="temperature" class="studio-slider temp" min="-100" max="100" step="1"
                            value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Tint</label>
                            <span class="slider-value" data-for="tint">0</span>
                        </div>
                        <input type="range" id="tint" class="studio-slider tint" min="-100" max="100" step="1"
                            value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Vibrance</label>
                            <span class="slider-value" data-for="vibrance">0</span>
                        </div>
                        <input type="range" id="vibrance" class="studio-slider" min="-100" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Saturation</label>
                            <span class="slider-value" data-for="saturation">0</span>
                        </div>
                        <input type="range" id="saturation" class="studio-slider" min="-100" max="100" step="1"
                            value="0">
                    </div>
                </div>

                <!-- Split Toning -->
                <div class="mt-6">
                    <h3 class="text-sm font-semibold text-gray-400 mb-3">Split Toning</h3>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="text-xs text-gray-500 mb-1 block">Highlights</label>
                            <div class="flex gap-2">
                                <input type="range" id="splitHighlightHue" class="studio-slider flex-1" min="0"
                                    max="360" step="1" value="0">
                                <input type="range" id="splitHighlightSat" class="studio-slider w-16" min="0" max="100"
                                    step="1" value="0">
                            </div>
                        </div>
                        <div>
                            <label class="text-xs text-gray-500 mb-1 block">Shadows</label>
                            <div class="flex gap-2">
                                <input type="range" id="splitShadowHue" class="studio-slider flex-1" min="0" max="360"
                                    step="1" value="0">
                                <input type="range" id="splitShadowSat" class="studio-slider w-16" min="0" max="100"
                                    step="1" value="0">
                            </div>
                        </div>
                    </div>
                    <div class="mt-2">
                        <label class="text-xs text-gray-500">Balance</label>
                        <input type="range" id="splitBalance" class="studio-slider" min="-100" max="100" step="1"
                            value="0">
                    </div>
                </div>

                <!-- HSL Mixer -->
                <div class="mt-6">
                    <h3 class="text-sm font-semibold text-gray-400 mb-3">HSL Mixer</h3>
                    <div class="flex gap-2 mb-4">
                        <button class="hsl-channel active" data-channel="hue">Hue</button>
                        <button class="hsl-channel" data-channel="sat">Saturation</button>
                        <button class="hsl-channel" data-channel="lum">Luminance</button>
                    </div>
                    <div id="hsl-sliders" class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-red-500"></div><input type="range" class="hsl-slider"
                                data-color="red" min="-100" max="100" value="0">
                        </div>
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-orange-500"></div><input type="range" class="hsl-slider"
                                data-color="orange" min="-100" max="100" value="0">
                        </div>
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-yellow-500"></div><input type="range" class="hsl-slider"
                                data-color="yellow" min="-100" max="100" value="0">
                        </div>
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-green-500"></div><input type="range" class="hsl-slider"
                                data-color="green" min="-100" max="100" value="0">
                        </div>
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-cyan-500"></div><input type="range" class="hsl-slider"
                                data-color="aqua" min="-100" max="100" value="0">
                        </div>
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-blue-500"></div><input type="range" class="hsl-slider"
                                data-color="blue" min="-100" max="100" value="0">
                        </div>
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-purple-500"></div><input type="range" class="hsl-slider"
                                data-color="purple" min="-100" max="100" value="0">
                        </div>
                        <div class="hsl-slider-group">
                            <div class="hsl-color-dot bg-pink-500"></div><input type="range" class="hsl-slider"
                                data-color="magenta" min="-100" max="100" value="0">
                        </div>
                    </div>
                </div>
            </div>

            <!-- EFFECTS Tab -->
            <div id="effects-panel" class="panel hidden">
                <!-- OUTPUT TRANSFORM (PRINT STOCK) -->
                <div class="mb-6 pb-4 border-b border-glass-border">
                    <div class="flex items-center justify-between mb-2">
                        <label class="text-xs text-hot-pink font-bold tracking-wider uppercase">Output Transform</label>
                        <span class="text-[10px] text-gray-500">Cinema Print Emulation</span>
                    </div>
                    <div class="flex bg-glass rounded-lg p-1 border border-glass-border">
                        <button
                            class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn active bg-hot-pink/20 text-hot-pink font-semibold shadow-[0_0_10px_rgba(237,39,136,0.2)]"
                            data-stock="0">Standard</button>
                        <button
                            class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn text-gray-400"
                            data-stock="1">Kodak 2383</button>
                        <button
                            class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn text-gray-400"
                            data-stock="2">Fuji 3513</button>
                        <button
                            class="flex-1 py-1.5 text-xs rounded hover:bg-white/10 transition-all print-stock-btn text-gray-400"
                            data-stock="3">Cineon Log</button>
                    </div>
                </div>

                <!-- Sub-tab Navigation (Pill Style) -->
                <div class="flex gap-2 mb-6 overflow-x-auto scrollbar-hide pb-1 border-b border-glass-border">
                    <button
                        class="fx-subtab-btn active px-3 py-1.5 rounded-lg bg-white/10 text-white text-xs font-semibold whitespace-nowrap hover:bg-white/20 transition-all"
                        data-subtab="optics">Optics</button>
                    <button
                        class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                        data-subtab="grain">Grain</button>
                    <button
                        class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                        data-subtab="vibe">Vibe</button>
                    <button
                        class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                        data-subtab="digital">Digital</button>
                    <button
                        class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                        data-subtab="texture">Texture</button>
                    <button
                        class="fx-subtab-btn px-3 py-1.5 rounded-lg text-gray-400 text-xs font-semibold whitespace-nowrap hover:bg-white/10 hover:text-white transition-all"
                        data-subtab="frame">Frame</button>
                </div>

                <!-- FRAME SUB-PANEL (Advanced Borders) -->
                <div id="fx-frame" class="fx-subpanel hidden">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between border-b border-glass-border pb-2">
                            <label class="text-sm font-semibold text-gray-300">Border Settings</label>
                            <div class="flex items-center gap-2">
                                <span class="text-xs text-gray-500">Enable</span>
                                <input type="checkbox" id="border-toggle" class="accent-hot-pink">
                            </div>
                        </div>

                        <div id="border-controls" class="space-y-4 opacity-50 pointer-events-none transition-opacity">
                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Border Width</label>
                                    <span class="slider-value" data-for="borderWidth">0%</span>
                                </div>
                                <input type="range" id="borderWidth" class="studio-slider" min="0" max="20" step="0.5"
                                    value="0">
                            </div>

                            <div class="bg-glass border border-glass-border rounded-lg p-3">
                                <label class="text-xs text-gray-400 mb-2 block">Border Color</label>
                                <div class="flex gap-2">
                                    <input type="color" id="borderColor" value="#ffffff"
                                        class="w-8 h-8 rounded cursor-pointer border-0 bg-transparent p-0">
                                    <div class="flex-1 grid grid-cols-5 gap-1">
                                        <button class="h-6 rounded bg-white border border-gray-600 border-color-preset"
                                            data-color="#ffffff"></button>
                                        <button class="h-6 rounded bg-black border border-gray-600 border-color-preset"
                                            data-color="#000000"></button>
                                        <button
                                            class="h-6 rounded bg-gray-500 border border-gray-600 border-color-preset"
                                            data-color="#808080"></button>
                                        <button
                                            class="h-6 rounded bg-[#ff0000] border border-gray-600 border-color-preset"
                                            data-color="#ff0000"></button>
                                        <button
                                            class="h-6 rounded bg-[#ed2788] border border-gray-600 border-color-preset"
                                            data-color="#ed2788"></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 1. OPTICS SUB-PANEL -->
                <div id="fx-optics" class="fx-subpanel active grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Dehaze</label>
                            <span class="slider-value" data-for="dehaze">0</span>
                        </div>
                        <input type="range" id="dehaze" class="studio-slider" min="-100" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Clarity</label>
                            <span class="slider-value" data-for="clarity">0</span>
                        </div>
                        <input type="range" id="clarity" class="studio-slider" min="-100" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Sharpness</label>
                            <span class="slider-value" data-for="sharpness">0</span>
                        </div>
                        <input type="range" id="sharpness" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Vignette</label>
                            <span class="slider-value" data-for="vignette">0</span>
                        </div>
                        <input type="range" id="vignette" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Fade</label>
                            <span class="slider-value" data-for="fade">0</span>
                        </div>
                        <input type="range" id="fade" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Bloom Strength</label>
                            <span class="slider-value" data-for="bloomStrength">0</span>
                        </div>
                        <input type="range" id="bloomStrength" class="studio-slider" min="0" max="100" step="1"
                            value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Bloom Threshold</label>
                            <span class="slider-value" data-for="bloomThreshold">70</span>
                        </div>
                        <input type="range" id="bloomThreshold" class="studio-slider" min="0" max="100" step="1"
                            value="70">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Lens Fringing</label>
                            <span class="slider-value" data-for="chromaticAberration">0</span>
                        </div>
                        <input type="range" id="chromaticAberration" class="studio-slider" min="0" max="100" step="1"
                            value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Halation</label>
                            <span class="slider-value" data-for="halation">0</span>
                        </div>
                        <input type="range" id="halation" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Diffusion</label>
                            <span class="slider-value" data-for="diffusion">0</span>
                        </div>
                        <input type="range" id="diffusion" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Barrel Distortion</label>
                            <span class="slider-value" data-for="barrelDistortion">0</span>
                        </div>
                        <input type="range" id="barrelDistortion" class="studio-slider" min="-100" max="100" step="1"
                            value="0">
                    </div>
                </div>

                <!-- 2. GRAIN SUB-PANEL -->
                <div id="fx-grain" class="fx-subpanel hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Global Grain</label>
                            <span class="slider-value" data-for="grainGlobal">1.0</span>
                        </div>
                        <input type="range" id="grainGlobal" class="studio-slider" min="0" max="2" step="0.1" value="1">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Shadow Grain</label>
                            <span class="slider-value" data-for="grainShadow">0</span>
                        </div>
                        <input type="range" id="grainShadow" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Highlight Grain</label>
                            <span class="slider-value" data-for="grainHighlight">0</span>
                        </div>
                        <input type="range" id="grainHighlight" class="studio-slider" min="0" max="100" step="1"
                            value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Grain Size</label>
                            <span class="slider-value" data-for="grainSize">1.0</span>
                        </div>
                        <input type="range" id="grainSize" class="studio-slider" min="0.5" max="3" step="0.1" value="1">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Noise Color</label>
                            <span class="slider-value" data-for="noiseColorHue">0</span>
                        </div>
                        <input type="range" id="noiseColorHue" class="studio-slider" min="0" max="360" step="1"
                            value="0">
                    </div>
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>AI Denoise</label>
                            <span class="slider-value" data-for="denoise">0</span>
                        </div>
                        <input type="range" id="denoise" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>

                    <!-- Dithering Engine -->
                    <div class="mt-4 pt-4 border-t border-glass-border">
                        <label class="text-xs text-gray-500 mb-2 block">Dithering (Lo-Fi)</label>
                        <div class="slider-group mb-2">
                            <div class="slider-header">
                                <label>Algorithm</label>
                            </div>
                            <select id="ditherType"
                                class="w-full bg-glass border border-glass-border rounded text-xs text-gray-300 p-2">
                                <option value="0">Off</option>
                                <option value="1">Floyd-Steinberg</option>
                                <option value="2">Atkinson (Mac)</option>
                                <option value="3">Bayer 4x4 (Retro)</option>
                                <option value="4">Random Noise</option>
                            </select>
                        </div>
                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Color Depth</label>
                                <span class="slider-value" data-for="ditherDepth">8</span>
                            </div>
                            <input type="range" id="ditherDepth" class="studio-slider" min="2" max="8" step="1"
                                value="8">
                        </div>
                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Strength</label>
                                <span class="slider-value" data-for="ditherStrength">0</span>
                            </div>
                            <input type="range" id="ditherStrength" class="studio-slider" min="0" max="100" step="1"
                                value="0">
                        </div>

                        <!-- LUT Export -->
                        <div class="mt-4 pt-4 border-t border-glass-border">
                            <button id="export-lut-btn"
                                class="w-full px-4 py-2 rounded-lg bg-gradient-to-r from-moonstone/30 to-hot-pink/30 
                                       text-white text-sm font-semibold hover:from-moonstone/50 hover:to-hot-pink/50 
                                       border border-moonstone/30 transition-all flex items-center justify-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                                Export as .cube LUT
                            </button>
                            <p class="text-xs text-gray-500 mt-2 text-center">Save your color grade for video editors
                            </p>
                        </div>
                    </div>
                </div>

                <!-- 3. VIBE SUB-PANEL -->
                <div id="fx-vibe" class="fx-subpanel hidden">

                    <div class="slider-group mb-4">
                        <label class="text-xs text-gray-500 mb-2 block">Border</label>
                        <select id="vibe-border-select"
                            class="w-full bg-glass border border-glass-border rounded text-xs text-gray-300 p-2 focus:ring-hot-pink focus:border-hot-pink">
                            <option value="">None</option>
                            <option value="assets/border.svg">Torn Paper</option>
                            <option value="assets/film.svg">Film Frame</option>
                        </select>
                    </div>

                    <!-- Texture Overlay Pack -->
                    <div class="mb-4 border-t border-glass-border pt-4">
                        <label class="text-xs text-gray-400 font-bold mb-2 block uppercase tracking-wider">Texture
                            Overlays</label>

                        <!-- Built-in Textures -->
                        <div class="grid grid-cols-4 gap-2 mb-3">
                            <button
                                class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                style="background-image: url('assets/textures/dust_scratches.png')" data-texture="dust"
                                data-mode="2" title="Dust & Scratches"></button>
                            <button
                                class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                style="background-image: url('assets/textures/leak_warm.png')" data-texture="leakWarm"
                                data-mode="2" title="Warm Leak"></button>
                            <button
                                class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                style="background-image: url('assets/textures/leak_cool.png')" data-texture="leakCool"
                                data-mode="2" title="Cool Leak"></button>
                            <button
                                class="texture-btn h-14 bg-gray-800 rounded-lg border border-glass-border hover:border-hot-pink bg-cover bg-center transition-all focus:ring-2 focus:ring-hot-pink"
                                style="background-image: url('assets/textures/paper.png')" data-texture="paper"
                                data-mode="1" title="Paper"></button>
                        </div>

                        <!-- Custom Import -->
                        <div class="flex gap-2 mb-3">
                            <button id="import-texture-btn"
                                class="flex-1 bg-glass border border-glass-border rounded p-2 text-xs text-gray-300 hover:bg-white/5 flex items-center justify-center gap-2">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                                </svg>
                                Custom...
                            </button>
                            <button id="remove-texture-btn"
                                class="px-3 bg-glass border border-glass-border rounded text-gray-400 hover:text-red-400 font-bold">
                                Ã—
                            </button>
                            <input type="file" id="texture-input" accept="image/*" class="hidden">
                        </div>

                        <!-- Controls -->
                        <div class="slider-group mb-2">
                            <div class="slider-header">
                                <label>Opacity</label>
                                <span class="slider-value" data-for="overlayOpacity">0</span>
                            </div>
                            <input type="range" id="overlayOpacity" class="studio-slider" min="0" max="100" value="0">
                        </div>

                        <!-- Blend Modes -->
                        <div class="flex gap-1" id="blend-mode-btns">
                            <button
                                class="blend-mode-btn flex-1 py-1 text-[10px] rounded border border-glass-border text-gray-400 hover:bg-white/10"
                                data-mode="2">Screen</button>
                            <button
                                class="blend-mode-btn flex-1 py-1 text-[10px] rounded border border-glass-border text-gray-400 hover:bg-white/10"
                                data-mode="3">Overlay</button>
                            <button
                                class="blend-mode-btn flex-1 py-1 text-[10px] rounded border border-glass-border text-gray-400 hover:bg-white/10"
                                data-mode="1">Multiply</button>
                        </div>
                    </div>

                    <!-- Date Stamp & Watermark -->
                    <div class="flex gap-2 mb-4">
                        <div class="flex-1 bg-glass border border-glass-border rounded p-2">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-xs text-gray-400">Date Stamp</label>
                                <input type="checkbox" id="date-toggle" class="accent-hot-pink">
                            </div>
                            <input type="color" id="date-color" value="#ff9900"
                                class="w-full h-6 bg-transparent cursor-pointer rounded">
                        </div>
                        <div class="flex-1 bg-glass border border-glass-border rounded p-2">
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-xs text-gray-400">Watermark</label>
                                <input type="checkbox" id="watermark-toggle" class="accent-hot-pink">
                            </div>
                            <input type="text" id="watermark-text" value="Untitled Studio"
                                class="w-full bg-black/50 border border-glass-border rounded text-[10px] px-1 py-1 text-white focus:border-hot-pink outline-none">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Film Scratches</label>
                                <span class="slider-value" data-for="scratches">0</span>
                            </div>
                            <input type="range" id="scratches" class="studio-slider" min="0" max="100" step="1"
                                value="0">
                        </div>
                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Film Gate Weave</label>
                                <span class="slider-value" data-for="filmGateWeave">0</span>
                            </div>
                            <input type="range" id="filmGateWeave" class="studio-slider" min="0" max="100" step="1"
                                value="0">
                        </div>
                    </div>

                    <button id="randomize-seed-btn"
                        class="w-full mt-3 py-1.5 rounded-lg bg-glass hover:bg-glass-border text-xs text-moonstone flex items-center justify-center gap-2 transition-all">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                        </svg>
                        Shuffle Defects
                    </button>

                    <div class="slider-group mt-4">
                        <div class="flex items-center justify-between">
                            <label class="text-xs text-gray-500 block">Gallery Frame</label>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="gallery-frame-toggle" class="sr-only peer">
                                <div
                                    class="w-9 h-5 bg-glass-border peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-white">
                                </div>
                            </label>
                        </div>
                        <div id="gallery-options" class="hidden mt-2 pl-2 border-l-2 border-white/20">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-[10px] text-gray-400">Theme</span>
                                <button id="gallery-theme-btn"
                                    class="text-[10px] px-2 py-0.5 rounded bg-white text-black font-bold">White</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 4. DIGITAL SUB-PANEL -->
                <div id="fx-digital" class="fx-subpanel hidden grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Glitch</label>
                            <span class="slider-value" data-for="glitchStrength">0</span>
                        </div>
                        <input type="range" id="glitchStrength" class="studio-slider" min="0" max="100" step="1"
                            value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Pixelate</label>
                            <span class="slider-value" data-for="pixelateSize">0</span>
                        </div>
                        <input type="range" id="pixelateSize" class="studio-slider" min="0" max="20" step="1" value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Dither</label>
                            <span class="slider-value" data-for="ditherStrength">0</span>
                        </div>
                        <input type="range" id="ditherStrength" class="studio-slider" min="0" max="100" step="1"
                            value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Scanlines</label>
                            <span class="slider-value" data-for="scanlineIntensity">0</span>
                        </div>
                        <input type="range" id="scanlineIntensity" class="studio-slider" min="0" max="100" step="1"
                            value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <label>ASCII</label>
                            <span class="slider-value" data-for="asciiSize">0</span>
                        </div>
                        <input type="range" id="asciiSize" class="studio-slider" min="0" max="2" step="0.01" value="0">
                    </div>

                    <div class="slider-group">
                        <div class="slider-header">
                            <label>Posterize</label>
                            <span class="slider-value" data-for="posterize">0</span>
                        </div>
                        <input type="range" id="posterize" class="studio-slider" min="0" max="100" step="1" value="0">
                    </div>
                </div>

                <!-- 5. TEXTURE SUB-PANEL -->
                <div id="fx-texture" class="fx-subpanel hidden">
                    <div class="flex items-center justify-between mb-3 border-b border-glass-border pb-2">
                        <label class="text-sm font-semibold text-gray-300">Texture Overlay</label>
                        <input type="file" id="texture-input" accept="image/png,image/jpeg" hidden>
                        <div class="flex gap-2">
                            <button id="remove-texture-btn"
                                class="text-xs text-red-400 hover:text-red-300 hidden">Remove</button>
                            <button id="import-texture-btn"
                                class="text-xs bg-glass hover:bg-glass-border px-2 py-1 rounded text-moonstone">+
                                Import</button>
                        </div>
                    </div>

                    <div id="texture-controls" class="space-y-4 opacity-50 pointer-events-none transition-opacity">
                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Opacity</label>
                                <span class="slider-value" data-for="overlayOpacity">0</span>
                            </div>
                            <input type="range" id="overlayOpacity" class="studio-slider" min="0" max="100" step="1"
                                value="0">
                        </div>

                        <div class="slider-group">
                            <label class="text-xs text-gray-500 mb-1 block">Blend Mode</label>
                            <div class="flex bg-glass rounded-lg p-1">
                                <button
                                    class="flex-1 py-1 text-xs rounded hover:bg-white/10 transition-colors blend-mode-btn"
                                    data-mode="1">Multiply</button>
                                <button
                                    class="flex-1 py-1 text-xs rounded hover:bg-white/10 transition-colors blend-mode-btn active bg-moonstone/20 text-moonstone"
                                    data-mode="2">Screen</button>
                                <button
                                    class="flex-1 py-1 text-xs rounded hover:bg-white/10 transition-colors blend-mode-btn"
                                    data-mode="3">Overlay</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 6. FRAME SUB-PANEL (New) -->
                <div id="fx-frame" class="fx-subpanel hidden">
                    <div class="flex items-center justify-between mb-4 border-b border-glass-border pb-2">
                        <label class="text-sm font-semibold text-gray-300">Frame Border</label>
                        <div class="flex items-center gap-2">
                            <span class="text-xs text-gray-500">Enable</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="border-toggle" class="sr-only peer">
                                <div
                                    class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-hot-pink rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-hot-pink">
                                </div>
                            </label>
                        </div>
                    </div>

                    <div id="border-controls"
                        class="space-y-4 transition-opacity duration-300 opacity-50 pointer-events-none">
                        <!-- Border Width -->
                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Thickness</label>
                                <span class="slider-value" id="border-width-val">0%</span>
                            </div>
                            <input type="range" id="border-width" class="studio-slider" min="0" max="20" step="0.1"
                                value="0">
                        </div>

                        <!-- Border Color -->
                        <div class="space-y-2">
                            <label class="text-xs text-gray-500">Color</label>
                            <div class="flex gap-2 mb-2">
                                <input type="color" id="border-color-picker"
                                    class="h-8 w-1/3 bg-transparent border-0 cursor-pointer" value="#ffffff">
                                <input type="text" id="border-color-hex"
                                    class="flex-1 bg-white/5 border border-white/10 rounded px-2 text-xs font-mono text-white"
                                    value="#FFFFFF">
                            </div>
                            <!-- Preset Colors -->
                            <div class="flex flex-wrap gap-2">
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #ffffff" data-color="#ffffff"></button>
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #000000" data-color="#000000"></button>
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #ff0000" data-color="#ff0000"></button>
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #00ff00" data-color="#00ff00"></button>
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #0000ff" data-color="#0000ff"></button>
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #ffff00" data-color="#ffff00"></button>
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #ff00ff" data-color="#ff00ff"></button>
                                <button
                                    class="w-6 h-6 rounded-full border border-white/20 hover:scale-110 transition-transform border-preset-btn"
                                    style="background: #00ffff" data-color="#00ffff"></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CROP Tab -->
            <div id="crop-panel" class="panel hidden">
                <div class="flex flex-wrap gap-4">
                    <div>
                        <label class="text-xs text-gray-500 mb-2 block">Aspect Ratio</label>
                        <div class="flex flex-wrap gap-1">
                            <button class="aspect-btn active" data-aspect="free">Free</button>
                            <button class="aspect-btn" data-aspect="original">Original</button>
                            <button class="aspect-btn" data-aspect="1:1">1:1</button>
                            <button class="aspect-btn" data-aspect="4:3">4:3</button>
                            <button class="aspect-btn" data-aspect="16:9">16:9</button>
                            <button class="aspect-btn" data-aspect="3:2">3:2</button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 mb-2 block">Rotate</label>
                        <div class="flex gap-2">
                            <button id="rotate-ccw-btn" class="p-2 rounded-lg bg-glass hover:bg-glass-border"
                                title="Rotate Left">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </button>
                            <input type="range" id="rotation" class="studio-slider w-32" min="-45" max="45" step="0.5"
                                value="0">
                            <button id="rotate-cw-btn" class="p-2 rounded-lg bg-glass hover:bg-glass-border"
                                title="Rotate Right">
                                <svg class="w-5 h-5 transform scale-x-[-1]" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div>
                        <label class="text-xs text-gray-500 mb-2 block">Flip</label>
                        <div class="flex gap-2">
                            <button id="flip-h-btn" class="p-2 rounded-lg bg-glass hover:bg-glass-border"
                                title="Flip Horizontal">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                </svg>
                            </button>
                            <button id="flip-v-btn" class="p-2 rounded-lg bg-glass hover:bg-glass-border"
                                title="Flip Vertical">
                                <svg class="w-5 h-5 transform rotate-90" fill="none" stroke="currentColor"
                                    viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="flex gap-2 ml-auto">
                        <button id="crop-reset-btn"
                            class="px-4 py-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass">Reset</button>
                        <button id="crop-apply-btn"
                            class="px-4 py-2 rounded-lg bg-hot-pink text-white font-semibold hover:bg-hot-pink/80">Apply
                            Crop</button>
                    </div>
                </div>
            </div>

            <!-- PRESETS Tab -->
            <div id="presets-panel" class="panel hidden h-full flex flex-col overflow-hidden">
                <!-- Categorized Browser -->
                <div id="preset-browser" class="flex-1 overflow-y-auto space-y-1 pr-1 custom-scrollbar">
                    
                    <!-- Essential / User -->
                    <div class="preset-group expanded" data-group="essentials">
                        <div class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                            <span class="text-xs font-bold tracking-widest text-hot-pink uppercase">Essentials</span>
                            <svg class="w-3 h-3 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </div>
                        <div class="group-content p-2 grid grid-cols-2 gap-2">
                            <button class="preset-category active" data-category="all">All Films</button>
                            <button class="preset-category" data-category="favorites">â­ Favorites</button>
                            <button class="preset-category" data-category="custom">My Presets</button>
                            <button id="save-preset-btn" class="px-3 py-1 rounded-lg bg-hot-pink/20 text-hot-pink text-xs font-semibold hover:bg-hot-pink/30">+ Save New</button>
                        </div>
                    </div>

                    <!-- Major Brands -->
                    <div class="preset-group" data-group="brands">
                        <div class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                            <span class="text-xs font-bold tracking-widest text-moonstone uppercase">Manufacturers</span>
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </div>
                        <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                            <button class="preset-category" data-category="kodak">Kodak</button>
                            <button class="preset-category" data-category="fuji">Fuji</button>
                            <button class="preset-category" data-category="ilford">Ilford</button>
                            <button class="preset-category" data-category="cinestill">Cinestill</button>
                            <button class="preset-category" data-category="agfa">Agfa</button>
                            <button class="preset-category" data-category="polaroid">Polaroid</button>
                            <button class="preset-category" data-category="rollei">Rollei</button>
                            <button class="preset-category" data-category="lomography">Lomo</button>
                            <button class="preset-category" data-category="konica">Konica</button>
                        </div>
                    </div>

                    <!-- Collections -->
                    <div class="preset-group" data-group="collections">
                        <div class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                            <span class="text-xs font-bold tracking-widest text-emerald-400 uppercase">Archives</span>
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </div>
                        <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                            <button class="preset-category" data-category="vintage">Vintage</button>
                            <button class="preset-category" data-category="obscure">Obscure</button>
                        </div>
                    </div>

                    <!-- Creative Styles -->
                    <div class="preset-group" data-group="styles">
                        <div class="group-header flex items-center justify-between px-3 py-2 bg-glass border-b border-glass-border cursor-pointer sticky top-0 z-10">
                            <span class="text-xs font-bold tracking-widest text-purple-400 uppercase">Creative</span>
                            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
                        </div>
                        <div class="group-content p-2 grid grid-cols-2 gap-2 hidden">
                            <button class="preset-category" data-category="modern">Modern</button>
                            <button class="preset-category" data-category="moody">Moody</button>
                            <button class="preset-category" data-category="dreamy">Dreamy</button>
                            <button class="preset-category" data-category="cinema">Cinema</button>
                            <button class="preset-category" data-category="monochrome">Monochrome</button>
                            <button class="preset-category" data-category="experimental">Experimental</button>
                            <button class="preset-category" data-category="muse">Muse</button>
                        </div>
                    </div>
                </div>

                <!-- 3D Preset Wheel -->
                <div id="preset-wheel-container" class="relative flex-1 perspective-1000 overflow-hidden my-2">
                    <!-- Center Marker Line -->
                    <div
                        class="absolute top-4 bottom-4 left-1/2 w-0.5 bg-gradient-to-b from-transparent via-hot-pink/50 to-transparent z-20 transform -translate-x-1/2 pointer-events-none">
                    </div>

                    <div id="preset-wheel"
                        class="wheel-scroll-area flex items-center px-[50%] gap-4 h-full overflow-x-auto scroll-snap-x snap-mandatory scrollbar-hide py-4">
                        <!-- Presets injected here -->
                    </div>
                </div>

                <!-- Active Preset Name Overlay -->
                <div id="active-preset-name"
                    class="text-center text-moonstone font-bold text-lg h-8 flex-shrink-0 transition-all opacity-0">
                </div>

                <!-- Preset Strength Slider -->
                <div id="preset-strength-container"
                    class="mt-2 pt-2 border-t border-glass-border hidden flex-shrink-0 bg-glass-panel">
                    <div class="flex items-center gap-4">
                        <span class="text-xs text-gray-400 uppercase tracking-wider">Strength</span>
                        <input type="range" id="preset-strength" class="studio-slider flex-1" min="0" max="100"
                            value="100">
                        <span id="preset-strength-value"
                            class="text-sm text-moonstone font-semibold w-12 text-right">100%</span>
                    </div>
                </div>
            </div>

            <!-- MASK Tab -->
            <div id="mask-panel" class="panel hidden">
                <div class="flex flex-col gap-4">
                    <!-- Add Mask Button -->
                    <button id="add-mask-btn"
                        class="w-full py-2 bg-white/10 hover:bg-white/20 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-colors">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                        </svg>
                        New Mask
                    </button>

                    <!-- Mask List -->
                    <div id="mask-list" class="space-y-2 max-h-40 overflow-y-auto">
                        <!-- Mask items injected by JS -->
                        <div class="text-center text-xs text-gray-500 py-4">No masks created</div>
                    </div>

                    <!-- Active Mask Controls (Initially Hidden) -->
                    <div id="mask-controls" class="hidden border-t border-glass-border pt-4 space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-xs font-semibold text-gray-400">Settings</span>
                            <button id="delete-mask-btn" class="text-xs text-red-400 hover:text-red-300">Delete</button>
                        </div>

                        <div class="flex items-center justify-between">
                            <label class="text-xs text-gray-300">Show Overlay</label>
                            <input type="checkbox" id="mask-overlay-toggle"
                                class="form-checkbox h-4 w-4 text-hot-pink rounded border-gray-600 bg-white/10 focus:ring-0 focus:ring-offset-0">
                        </div>

                        <div class="flex items-center justify-between">
                            <label class="text-xs text-gray-300">Invert</label>
                            <input type="checkbox" id="mask-invert"
                                class="w-4 h-4 rounded bg-white/10 border-white/20 text-hot-pink focus:ring-hot-pink">
                        </div>

                        <div class="space-y-3 pt-2 border-t border-glass-border">
                            <div class="text-xs font-semibold text-gray-400">Transform</div>

                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>X</label>
                                    <span class="slider-value" data-for="mask-x">0.5</span>
                                </div>
                                <input type="range" id="mask-x" class="studio-slider" min="0" max="1" step="0.01"
                                    value="0.5">
                            </div>

                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Y</label>
                                    <span class="slider-value" data-for="mask-y">0.5</span>
                                </div>
                                <input type="range" id="mask-y" class="studio-slider" min="0" max="1" step="0.01"
                                    value="0.5">
                            </div>

                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Radius</label>
                                    <span class="slider-value" data-for="mask-radius">0.3</span>
                                </div>
                                <input type="range" id="mask-radius" class="studio-slider" min="0" max="1" step="0.01"
                                    value="0.3">
                            </div>

                            <div class="slider-group">
                                <div class="slider-header">
                                    <label>Rotation</label>
                                    <span class="slider-value" data-for="mask-rotation">0</span>
                                </div>
                                <input type="range" id="mask-rotation" class="studio-slider" min="0" max="360" step="1"
                                    value="0">
                            </div>
                        </div>

                        <div class="slider-group">
                            <div class="slider-header">
                                <label>Feather</label>
                                <span class="slider-value" data-for="mask-feather">0.2</span>
                            </div>
                            <input type="range" id="mask-feather" class="studio-slider" min="0" max="1" step="0.01"
                                value="0.2">
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Bar -->
        <div class="flex items-center justify-between px-4 py-3 border-t border-glass-border bg-midnight/50">
            <div class="flex items-center gap-2">
                <button id="reset-btn"
                    class="px-4 py-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all text-sm font-medium">
                    Reset All
                </button>
                <button id="toggle-histogram-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Toggle Histogram">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                </button>
                <button id="toggle-history-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Toggle History">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </button>
            </div>
            <div class="flex items-center gap-3">
                <!-- Social Media Quick Export -->
                <div class="relative">
                    <button id="social-export-btn"
                        class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                        title="Quick Export for Social Media">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </button>
                    <div id="social-export-menu"
                        class="absolute bottom-full right-0 mb-2 bg-glass backdrop-blur-glass border border-glass-border rounded-xl p-2 min-w-48 hidden z-50">
                        <div class="text-xs text-gray-500 uppercase tracking-wider px-2 py-1 mb-1">Quick Export</div>
                        <button
                            class="social-export-option w-full text-left px-3 py-2 rounded-lg hover:bg-glass-border text-sm flex items-center gap-3"
                            data-size="instagram-square">
                            <span
                                class="w-6 h-6 rounded bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-xs font-bold">IG</span>
                            <span>Instagram Square<span class="text-gray-500 ml-2">1080Ã—1080</span></span>
                        </button>
                        <button
                            class="social-export-option w-full text-left px-3 py-2 rounded-lg hover:bg-glass-border text-sm flex items-center gap-3"
                            data-size="instagram-story">
                            <span
                                class="w-6 h-6 rounded bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-xs font-bold">IG</span>
                            <span>Instagram Story<span class="text-gray-500 ml-2">1080Ã—1920</span></span>
                        </button>
                        <button
                            class="social-export-option w-full text-left px-3 py-2 rounded-lg hover:bg-glass-border text-sm flex items-center gap-3"
                            data-size="twitter">
                            <span
                                class="w-6 h-6 rounded bg-blue-500 flex items-center justify-center text-xs font-bold">X</span>
                            <span>Twitter/X<span class="text-gray-500 ml-2">1200Ã—675</span></span>
                        </button>
                        <button
                            class="social-export-option w-full text-left px-3 py-2 rounded-lg hover:bg-glass-border text-sm flex items-center gap-3"
                            data-size="facebook">
                            <span
                                class="w-6 h-6 rounded bg-blue-600 flex items-center justify-center text-xs font-bold">FB</span>
                            <span>Facebook<span class="text-gray-500 ml-2">1200Ã—630</span></span>
                        </button>
                    </div>


                </div>

                <button id="export-settings-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass transition-all"
                    title="Export Settings">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                </button>
                <select id="export-format"
                    class="px-3 py-2 rounded-lg bg-glass border border-glass-border text-sm focus:border-moonstone focus:outline-none">
                    <option value="jpeg">JPEG</option>
                    <option value="png">PNG</option>
                </select>

                <!-- Magic Wand (Auto) Button -->
                <button id="magic-wand-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-yellow-400 hover:bg-glass transition-all"
                    title="Auto Enhance">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                    </svg>
                </button>

                <!-- Share Button -->
                <button id="share-btn"
                    class="p-2 rounded-lg text-gray-400 hover:text-moonstone hover:bg-glass transition-all disabled:opacity-50"
                    title="Share" disabled>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                    </svg>
                </button>

                <button id="export-btn"
                    class="export-button px-6 py-2 rounded-xl bg-gradient-to-r from-hot-pink to-pink-600 text-white font-semibold hover:shadow-lg hover:shadow-hot-pink/30 transition-all duration-300 flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"
                    disabled>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Export
                </button>
            </div>
        </div>

        <!-- Brand Credit Footer -->
        <div class="brand-credit">
            <span class="brand-credit-text">Untitled Studio // developed by <span
                    class="brand-credit-author">mhs</span></span>
        </div>
    </aside>

    <!-- Export Settings Modal -->
    <div id="export-settings-modal"
        class="fixed inset-0 z-[100] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-96 max-w-[90vw]">
            <h3 class="text-lg font-bold mb-4">Export Settings</h3>

            <div class="space-y-4">
                <div>
                    <label class="text-sm text-gray-400 mb-1 block">Resolution</label>
                    <select id="export-resolution"
                        class="w-full px-3 py-2 rounded-lg bg-midnight/50 border border-glass-border focus:border-moonstone focus:outline-none">
                        <option value="original">Original</option>
                        <option value="4k">4K (3840px)</option>
                        <option value="2k">2K (2560px)</option>
                        <option value="1080p">1080p (1920px)</option>
                        <option value="720p">720p (1280px)</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <div id="custom-resolution-group" class="hidden">
                    <label class="text-sm text-gray-400 mb-1 block">Custom Width (px)</label>
                    <input type="number" id="export-custom-width"
                        class="w-full px-3 py-2 rounded-lg bg-midnight/50 border border-glass-border focus:border-moonstone focus:outline-none"
                        placeholder="1920">
                </div>

                <div>
                    <label class="text-sm text-gray-400 mb-1 block">Quality (JPEG)</label>
                    <div class="flex items-center gap-3">
                        <input type="range" id="export-quality" class="studio-slider flex-1" min="50" max="100"
                            value="95">
                        <span id="export-quality-value" class="text-moonstone font-semibold w-12 text-right">95%</span>
                    </div>
                </div>

                <div class="flex items-center gap-3">
                    <input type="checkbox" id="export-exif" class="w-4 h-4 accent-hot-pink" checked>
                    <label for="export-exif" class="text-sm">Preserve EXIF data</label>
                </div>
            </div>

            <div class="flex justify-end gap-3 mt-6">
                <button id="export-settings-cancel"
                    class="px-4 py-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass">Cancel</button>
                <button id="export-settings-save"
                    class="px-4 py-2 rounded-lg bg-hot-pink text-white font-semibold hover:bg-hot-pink/80">Save</button>
            </div>
        </div>
    </div>

    <!-- Save Preset Modal -->
    <div id="save-preset-modal"
        class="fixed inset-0 z-[100] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-96 max-w-[90vw]">
            <h3 class="text-lg font-bold mb-4">Save Preset</h3>

            <div class="space-y-4">
                <div>
                    <label class="text-sm text-gray-400 mb-1 block">Preset Name</label>
                    <input type="text" id="preset-name-input"
                        class="w-full px-3 py-2 rounded-lg bg-midnight/50 border border-glass-border focus:border-moonstone focus:outline-none"
                        placeholder="My Awesome Look">
                </div>
            </div>

            <!-- Footer Credit -->
            <div class="mt-8 text-center opacity-30 hover:opacity-100 transition-opacity">
                <p class="text-[10px] font-mono">
                    Untitled Studio v1.0 <br>
                    <span class="brand-credit-author cursor-pointer hover:text-emerald-400 transition-colors">Built by
                        MHS</span>
                </p>
            </div>


            <div class="flex justify-end gap-3 mt-6">
                <button id="save-preset-cancel"
                    class="px-4 py-2 rounded-lg text-gray-400 hover:text-white hover:bg-glass">Cancel</button>
                <button id="save-preset-confirm"
                    class="px-4 py-2 rounded-lg bg-hot-pink text-white font-semibold hover:bg-hot-pink/80">Save</button>
            </div>
        </div>
    </div>

    <!-- Export Progress Modal (Enhanced) -->
    <div id="export-modal"
        class="fixed inset-0 z-[100] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div
            class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-[28rem] max-w-[95vw] max-h-[85vh] overflow-hidden flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between mb-4">
                <h3 class="text-lg font-bold text-white">Exporting</h3>
                <span id="export-eta" class="text-sm text-gray-400">Calculating...</span>
            </div>

            <!-- Overall Progress -->
            <div class="mb-4">
                <div class="flex items-center justify-between text-sm mb-1">
                    <span class="text-gray-400">Overall Progress</span>
                    <span id="export-overall-text" class="text-hot-pink font-bold">0 / 0</span>
                </div>
                <div class="h-2 bg-glass-border rounded-full overflow-hidden">
                    <div id="export-overall-bar"
                        class="h-full bg-gradient-to-r from-hot-pink to-deep-blue transition-all duration-300"
                        style="width: 0%"></div>
                </div>
            </div>

            <!-- Image Queue (scrollable) -->
            <div id="export-queue" class="flex-1 overflow-y-auto space-y-2 max-h-64 scrollbar-hide mb-4">
                <!-- Image items will be inserted here dynamically -->
            </div>

            <!-- Current Status -->
            <div class="text-center py-3 border-t border-glass-border">
                <p id="export-status" class="text-sm text-gray-400">Preparing export...</p>
            </div>

            <!-- Cancel Button -->
            <button id="export-cancel-btn"
                class="w-full py-2 text-sm text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-all">
                Cancel Export
            </button>
        </div>
    </div>

    <!-- Batch Export Modal -->
    <div id="batch-export-modal"
        class="fixed inset-0 z-[100] bg-midnight/90 backdrop-blur-sm flex items-center justify-center hidden">
        <div class="bg-glass backdrop-blur-glass border border-glass-border rounded-2xl p-6 w-96 max-w-[90vw]">
            <h3 class="text-lg font-bold mb-4">Batch Export</h3>
            <p class="text-sm text-gray-400 mb-6">How do you want to save your edited photos?</p>

            <div class="space-y-3">
                <button id="batch-mode-zip"
                    class="w-full text-left p-4 rounded-xl bg-glass hover:bg-glass-border border border-glass-border transition-all group">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-lg bg-indigo-500/20 text-indigo-400 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4">
                                </path>
                            </svg>
                        </div>
                        <div>
                            <div class="font-semibold text-white">ZIP Archive</div>
                            <div class="text-xs text-gray-500">One single compressed file</div>
                        </div>
                    </div>
                </button>

                <button id="batch-mode-waterfall"
                    class="w-full text-left p-4 rounded-xl bg-glass hover:bg-glass-border border border-glass-border transition-all group">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-lg bg-emerald-500/20 text-emerald-400 flex items-center justify-center group-hover:scale-110 transition-transform">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
                            </svg>
                        </div>
                        <div>
                            <div class="font-semibold text-white">Individual Files</div>
                            <div class="text-xs text-gray-500">Save separately (Waterfall)</div>
                        </div>
                    </div>
                </button>
            </div>

            <button id="batch-modal-close"
                class="w-full mt-6 py-2 text-sm text-gray-500 hover:text-white transition-colors">Cancel</button>
        </div>
    </div>

    <!-- ASCII Toast Message -->
    <div id="ascii-toast" class="ascii-toast">
        <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  yap yap ðŸ˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        </pre>
    </div>

    <!-- Core Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="js/shaders.js?v=16"></script>
    <script src="js/presets.js?v=14"></script>
    <script src="js/storage.js?v=14"></script>
    <script src="js/histogram.js?v=14"></script>
    <script src="js/tone-curve.js?v=14"></script>
    <script src="js/history.js?v=14"></script>
    <script src="js/state-manager.js?v=14"></script>
    <script src="js/crop-tool.js?v=14"></script>
    <script src="js/gesture-handler.js?v=14"></script>
    <script src="js/export-manager.js?v=14"></script>
    <script src="js/raw-decoder.js?v=14"></script>
    <script src="js/lut-exporter.js?v=14"></script>
    <script src="js/webgl-engine.js?v=16"></script>
    <script src="js/textures.js?v=14"></script>
    <script src="js/app.js?v=16"></script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js?v=15')
                    .then(reg => {
                        console.log('âœ“ Service Worker registered');
                        // Force update
                        reg.update();
                    })
                    .catch(err => console.error('âœ— SW registration failed:', err));
            });
        }
    </script>
</body>

</html>